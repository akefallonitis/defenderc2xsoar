{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# \ud83d\udda5\ufe0f DefenderC2 Command & Control Console\n\n## Multi-Tenant Defender XDR Management (Hybrid Mode)\n\n**ARM Actions** for secure execution + **CustomEndpoint** for monitoring\n\nSelect your Function App below to auto-populate connection parameters."
      },
      "name": "header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "function-app-selector",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionApp",
            "label": "\ud83d\udd27 DefenderC2 Function App",
            "type": 5,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where type == 'microsoft.web/sites' and kind == 'functionapp' | project id, name, resourceGroup, subscriptionId | order by name asc",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "subscription-hidden",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ]
          },
          {
            "id": "resourcegroup-hidden",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = resourceGroup",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ]
          },
          {
            "id": "function-name-hidden",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionAppName",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = name",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ]
          },
          {
            "id": "tenant-id-selector",
            "version": "KqlParameterItem/1.0",
            "name": "TenantId",
            "label": "\ud83c\udfe2 Defender XDR Tenant",
            "type": 2,
            "isRequired": true,
            "isGlobal": true,
            "multiSelect": false,
            "query": "ResourceContainers | where type == 'microsoft.resources/subscriptions' | project tenantId | distinct tenantId | project value = tenantId, label = strcat('\ud83c\udfe2 Tenant: ', tenantId) | order by label asc",
            "crossComponentResources": [
              "value::all"
            ],
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "typeSettings": {
              "additionalResourceOptions": [],
              "selectFirstItem": true,
              "showDefault": false
            },
            "defaultValue": "value::1",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "device-list-dropdown",
            "version": "KqlParameterItem/1.0",
            "name": "DeviceList",
            "label": "\ud83d\udcbb Select Devices",
            "type": 2,
            "isRequired": false,
            "isGlobal": true,
            "multiSelect": true,
            "quote": "",
            "delimiter": ",",
            "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"value\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"label\"}]}}]}",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 10,
            "description": "\u2705 Auto-populated from Defender XDR",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionAppName}"
              },
              {
                "criterionType": "param",
                "value": "{TenantId}"
              }
            ]
          },
          {
            "id": "scan-type-param",
            "version": "KqlParameterItem/1.0",
            "name": "ScanType",
            "label": "\ud83d\udd0d Scan Type",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\n  {\"value\": \"Quick\", \"label\": \"Quick Scan\"},\n  {\"value\": \"Full\", \"label\": \"Full Scan\"}\n]",
            "value": "Quick"
          },
          {
            "id": "isolation-type-param",
            "version": "KqlParameterItem/1.0",
            "name": "IsolationType",
            "label": "\ud83d\udd12 Isolation Type",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\n  {\"value\": \"Full\", \"label\": \"Full Isolation\"},\n  {\"value\": \"Selective\", \"label\": \"Selective Isolation\"}\n]",
            "value": "Full"
          },
          {
            "id": "action-trigger",
            "version": "KqlParameterItem/1.0",
            "name": "ActionTrigger",
            "label": "\ud83c\udfaf Action Control",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\n  {\"value\": \"none\", \"label\": \"-- Select Action to Execute --\"},\n  {\"value\": \"scan\", \"label\": \"\ud83d\udd0d Run Antivirus Scan\"},\n  {\"value\": \"isolate\", \"label\": \"\ud83d\udd12 Isolate Device(s)\"},\n  {\"value\": \"unisolate\", \"label\": \"\ud83d\udd13 Unisolate Device(s)\"},\n  {\"value\": \"collect\", \"label\": \"\ud83d\udce6 Collect Investigation Package\"},\n  {\"value\": \"restrict\", \"label\": \"\ud83d\udeab Restrict App Execution\"},\n  {\"value\": \"unrestrict\", \"label\": \"\u2705 Unrestrict App Execution\"}\n]",
            "value": "none"
          },
          {
            "id": "last-action-id",
            "version": "KqlParameterItem/1.0",
            "name": "LastActionId",
            "label": "\ud83d\udcdd Last Action ID (for tracking)",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Paste an Action ID here to track its status"
          },
          {
            "id": "cancel-action-id",
            "version": "KqlParameterItem/1.0",
            "name": "CancelActionId",
            "label": "\u274c Action ID to Cancel",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Paste an Action ID here to cancel it"
          },
          {
            "id": "auto-refresh",
            "version": "KqlParameterItem/1.0",
            "name": "AutoRefresh",
            "label": "\ud83d\udd04 Auto Refresh",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\n  {\"value\": \"0\", \"label\": \"Off\"},\n  {\"value\": \"10000\", \"label\": \"Every 10 seconds\"},\n  {\"value\": \"30000\", \"label\": \"Every 30 seconds\"},\n  {\"value\": \"60000\", \"label\": \"Every 1 minute\"},\n  {\"value\": \"300000\", \"label\": \"Every 5 minutes\"}\n]",
            "value": "30000"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n## \ud83c\udfaf Device Actions (ARM Actions)\n\nSelect one or more devices above, then click an action button below.\n\n**These actions use Azure ARM invocations** for full RBAC integration and audit trail."
      },
      "name": "actions-header"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "list",
        "links": [
          {
            "id": "isolate-action",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udd12 Isolate Devices",
            "style": "primary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Isolate Device"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "isolationType",
                  "value": "Full"
                },
                {
                  "key": "comment",
                  "value": "Isolated via DefenderC2 Workbook by {name:escape}"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Isolate Devices",
              "description": "Isolate Devices initiated successfully",
              "actionName": "Isolate Devices",
              "runLabel": "Isolate Devices",
              "successMessage": "\u2705 Isolate Devices command sent successfully!"
            }
          },
          {
            "id": "unisolate-action",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udd13 Unisolate Devices",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Unisolate Device"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Unisolated via DefenderC2 Workbook by {name:escape}"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Unisolate Devices",
              "description": "Unisolate Devices initiated successfully",
              "actionName": "Unisolate Devices",
              "runLabel": "Unisolate Devices",
              "successMessage": "\u2705 Unisolate Devices command sent successfully!"
            }
          },
          {
            "id": "scan-action",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udd0d Run Antivirus Scan",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Run Antivirus Scan"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "scanType",
                  "value": "Quick"
                },
                {
                  "key": "comment",
                  "value": "Scan initiated via DefenderC2 Workbook by {name:escape}"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Run Antivirus Scan",
              "description": "Run Antivirus Scan initiated successfully",
              "actionName": "Run Antivirus Scan",
              "runLabel": "Run Antivirus Scan",
              "successMessage": "\u2705 Run Antivirus Scan command sent successfully!"
            }
          },
          {
            "id": "collect-action",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udce6 Collect Investigation Package",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Collect Investigation Package"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Investigation package collection via DefenderC2 Workbook by {name:escape}"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Collect Investigation Package",
              "description": "Collect Investigation Package initiated successfully",
              "actionName": "Collect Investigation Package",
              "runLabel": "Collect Investigation Package",
              "successMessage": "\u2705 Collect Investigation Package command sent successfully!"
            }
          },
          {
            "id": "restrict-action",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udeab Restrict App Execution",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Restrict App Execution"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "App restriction via DefenderC2 Workbook by {name:escape}"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Restrict App Execution",
              "description": "Restrict App Execution initiated successfully",
              "actionName": "Restrict App Execution",
              "runLabel": "Restrict App Execution",
              "successMessage": "\u2705 Restrict App Execution command sent successfully!"
            }
          },
          {
            "id": "unrestrict-action",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\u2705 Unrestrict App Execution",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Unrestrict App Execution"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "App unrestriction via DefenderC2 Workbook by {name:escape}"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Unrestrict App Execution",
              "description": "Unrestrict App Execution initiated successfully",
              "actionName": "Unrestrict App Execution",
              "runLabel": "Unrestrict App Execution",
              "successMessage": "\u2705 Unrestrict App Execution command sent successfully!"
            }
          },
          {
            "id": "cancel-action",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\u274c Cancel Machine Action",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Cancel Action"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "actionId",
                  "value": "{CancelActionId}"
                },
                {
                  "key": "comment",
                  "value": "Cancelled via DefenderC2 Workbook by {name:escape}"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Cancel Action",
              "description": "Cancel Action initiated successfully",
              "actionName": "Cancel Action",
              "runLabel": "Cancel Action",
              "successMessage": "\u2705 Cancel Action command sent successfully!"
            },
            "conditionalVisibility": {
              "parameterName": "CancelActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "arm-actions"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n## \ud83d\udcca Monitoring & Status (CustomEndpoint)\n\nReal-time monitoring with auto-refresh capability."
      },
      "name": "monitoring-header"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udcca Action Status Tracking - {LastActionId}",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udd0d Real-time Action Tracking\n\n**Tracking Action ID:** {LastActionId}\n\nThis section provides real-time status updates for the specified action. **Auto-refreshes every {AutoRefresh:label}**.\n\n\ud83d\udca1 **Tip:** Copy an Action ID from any execution result or the history table below."
            },
            "name": "tracking-info"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Action Status\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"actionId\",\"value\":\"{LastActionId}\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.id\",\"columnid\":\"Action ID\"},{\"path\":\"$.type\",\"columnid\":\"Action Type\"},{\"path\":\"$.status\",\"columnid\":\"Current Status\"},{\"path\":\"$.machineId\",\"columnid\":\"Device ID\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"Device Name\"},{\"path\":\"$.requestor\",\"columnid\":\"Requestor\"},{\"path\":\"$.creationDateTimeUtc\",\"columnid\":\"Created\"},{\"path\":\"$.lastUpdateDateTimeUtc\",\"columnid\":\"Last Updated\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udcc8 Live Action Status",
              "noDataMessage": "Enter an Action ID in the 'Last Action ID' parameter above to track",
              "noDataMessageStyle": 3,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Current Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "yellow",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "blue",
                          "text": "\ud83d\udd35 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "redBright",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Cancelled",
                          "representation": "gray",
                          "text": "\u26ab {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "gray",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ]
              }
            },
            "name": "action-status-tracking"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "LastActionId",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "status-tracking-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udcdc Machine Actions History - Auto-Refreshing Feed",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udd52 Complete Machine Actions History\n\nShows all machine actions across your Defender XDR tenant. **Auto-refreshes every {AutoRefresh:label}**.\n\n\ud83d\udca1 **Tip:** Click any Action ID to copy it for tracking or cancellation."
            },
            "name": "history-info"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"action\",\"value\":\"Get All Actions\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.actions[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"Action ID\"},{\"path\":\"$.type\",\"columnid\":\"Action Type\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.requestor\",\"columnid\":\"Requestor\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"Device Name\"},{\"path\":\"$.machineId\",\"columnid\":\"Device ID\"},{\"path\":\"$.creationDateTimeUtc\",\"columnid\":\"Created\"},{\"path\":\"$.lastUpdateDateTimeUtc\",\"columnid\":\"Last Updated\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udccb All Machine Actions (Auto-Refreshing)",
              "noDataMessage": "No machine actions found. Execute an action above to see results here.",
              "noDataMessageStyle": 3,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Action ID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\ud83d\udcca Track",
                      "parameterName": "LastActionId",
                      "parameterValue": "{0}",
                      "linkIsContextBlade": false
                    },
                    "tooltipFormat": {
                      "tooltip": "Click to auto-populate LastActionId for tracking/canceling"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "success",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "2",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "\ud83d\udd35 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "failed",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Cancelled",
                          "representation": "4",
                          "text": "\u26ab {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Created",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Created",
                  "sortOrder": 2
                }
              ]
            },
            "name": "machine-actions-history"
          }
        ]
      },
      "name": "machine-actions-history-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udcbb Device Inventory - All Discovered Devices",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udda5\ufe0f Complete Device Inventory\n\nShows all devices in your Defender XDR tenant with risk scoring and health status.\n\n**Auto-refreshes every {AutoRefresh:label}**"
            },
            "name": "devices-info"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.computerDnsName\",\"columnid\":\"Device Name\"},{\"path\":\"$.osPlatform\",\"columnid\":\"OS Platform\"},{\"path\":\"$.osVersion\",\"columnid\":\"OS Version\"},{\"path\":\"$.riskScore\",\"columnid\":\"Risk Score\"},{\"path\":\"$.healthStatus\",\"columnid\":\"Health Status\"},{\"path\":\"$.lastIpAddress\",\"columnid\":\"Last IP\"},{\"path\":\"$.lastSeen\",\"columnid\":\"Last Seen\"},{\"path\":\"$.id\",\"columnid\":\"Device ID\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udcbb All Devices (Auto-Refreshing)",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Risk Score",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "\ud83d\udd34 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "\ud83d\udfe1 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "green",
                          "text": "\ud83d\udfe2 {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "green",
                          "text": "\ud83d\udfe2 {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Health Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Active",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Inactive",
                          "representation": "failed",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Device ID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "\ud83d\udccb Copy"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Risk Score",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Risk Score",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "TenantId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "device-inventory"
          }
        ]
      },
      "name": "device-inventory-group"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/80110e3c-3ec4-4567-b06d-7d47a72562f5/resourcegroups/alex-testing-rg"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}