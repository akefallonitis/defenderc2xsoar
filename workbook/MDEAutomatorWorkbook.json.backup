{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# MDEAutomator Workbook\n\n> A port of [MDEAutomator](https://github.com/msdirtbag/MDEAutomator) using Azure Sentinel Workbooks for multi-tenant Microsoft Defender for Endpoint automation.\n\n---\n\n## Configuration\n\nConfigure your tenant and function app settings below:"
      },
      "name": "text - header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "parameters": [
          {
            "id": "1f74ed9a-e3ed-498d-bd5b-f68f3836a117",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": false,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "b616a3a3-4271-4208-b1a9-a92a78efed08",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources\n| where type =~ 'microsoft.operationalinsights/workspaces'\n| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "8c4e5f38-a6cd-4642-9f0d-2f2e5d7b3c1a",
            "version": "KqlParameterItem/1.0",
            "name": "TenantId",
            "label": "Target Tenant ID",
            "type": 1,
            "isRequired": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "value": ""
          },
          {
            "id": "9d5e6f49-b7de-5753-a0e1-3f3f6e8c4d2b",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionAppUrl",
            "label": "Function App Base URL",
            "type": 1,
            "isRequired": true,
            "description": "Base URL of your Azure Function App (e.g., https://your-function-app.azurewebsites.net)",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": ""
          },
          {
            "id": "a1e7f5a-c8ef-6864-b1f2-4g4g7f9d5e3c",
            "version": "KqlParameterItem/1.0",
            "name": "SpnId",
            "label": "Service Principal (App) ID",
            "type": 1,
            "isRequired": true,
            "description": "Multi-tenant App Registration Client ID",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": ""
          },
          {
            "id": "b2f8g6b-d9fg-7975-c2g3-5h5h8g0e6f4d",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 2592000000
            }
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - configuration"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "4e8c3d7a-2b1f-4a8d-9e5c-1a2b3c4d5e6f",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "MDEAutomator",
            "subTarget": "automator",
            "style": "link"
          },
          {
            "id": "5f9d4e8b-3c2g-5b9e-0f6d-2b3c4d5e6f7g",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Threat Intel Manager",
            "subTarget": "threatintel",
            "style": "link"
          },
          {
            "id": "6g0e5f9c-4d3h-6c0f-1g7e-3c4d5e6f7g8h",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Action Manager",
            "subTarget": "actions",
            "style": "link"
          },
          {
            "id": "7h1f6g0d-5e4i-7d1g-2h8f-4d5e6f7g8h9i",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Hunt Manager",
            "subTarget": "hunting",
            "style": "link"
          },
          {
            "id": "8i2g7h1e-6f5j-8e2h-3i9g-5e6f7g8h9i0j",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Incident Manager",
            "subTarget": "incidents",
            "style": "link"
          },
          {
            "id": "9j3h8i2f-7g6k-9f3i-4j0h-6f7g8h9i0j1k",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Custom Detection Manager",
            "subTarget": "detections",
            "style": "link"
          },
          {
            "id": "0k4i9j3g-8h7m-1h5k-6l2j-8h9i0j1k2l3m",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udda5\ufe0f Interactive Console",
            "subTarget": "console",
            "style": "link"
          }
        ]
      },
      "name": "links - tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## MDEAutomator - Device Response Actions\n\n### Dispatcher Actions\nPerform bulk response actions across your MDE endpoints:\n\n- **Isolate Device** - Network isolate devices (selective isolation with exclusion rules)\n- **Collect Investigation Package** - Gather forensic artifacts from endpoints\n- **Run Antivirus Scan** - Execute full disk scan on devices\n- **Restrict App Execution** - Allow only Microsoft-signed binaries\n- **Stop & Quarantine File** - Stop and quarantine malicious files\n\n### Orchestrator Actions\nExecute Live Response operations:\n\n- **Run Live Response Script** - Execute PowerShell scripts from LR library\n- **Collect File** - Retrieve files from endpoints\n- **Put File** - Push files to endpoints from LR library\n- **Upload to Live Response Library** - Add scripts/files to library"
            },
            "name": "text - automator-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "c3i9h4j3g-8h7l-0g4j-5k1i-7g8h9i0j1k2l",
                  "version": "KqlParameterItem/1.0",
                  "name": "ActionType",
                  "label": "Select Action",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Isolate Device\", \"Unisolate Device\", \"Restrict App Execution\", \"Unrestrict App Execution\", \"Collect Investigation Package\", \"Run Antivirus Scan\", \"Stop & Quarantine File\", \"Run Live Response Script\", \"Get File\", \"Put File\", \"Upload to LR Library\"]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "d4j0i5k4h-9i8m-1h5k-6l2j-8h9i0j1k2l3m",
                  "version": "KqlParameterItem/1.0",
                  "name": "DeviceFilter",
                  "label": "Device Filter (OData syntax)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Filter devices using OData query syntax (e.g., healthStatus eq 'Active')",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "e5k1j6l5i-0j9n-2i6l-7m3k-9i0j1k2l3m4n",
                  "version": "KqlParameterItem/1.0",
                  "name": "DeviceId",
                  "label": "Device ID (for specific targeting)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Specific device ID to target",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "f6l2k7m6j-1k0o-3j7m-8n4l-0j1k2l3m4n5o",
                  "version": "KqlParameterItem/1.0",
                  "name": "Comment",
                  "label": "Action Comment",
                  "type": 1,
                  "isRequired": false,
                  "description": "Optional comment for the action",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - automator-actions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"{ActionType}\"},{\"key\":\"deviceFilter\",\"value\":\"{DeviceFilter}\"},{\"key\":\"deviceId\",\"value\":\"{DeviceId}\"},{\"key\":\"comment\",\"value\":\"{Comment}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üéØ Execute Action: {ActionType}",
              "noDataMessage": "Click 'Run Query' to execute the selected action",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - execute-action"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üìä Device List Query\n\nView devices in your environment matching the filter criteria."
            },
            "name": "text - device-list-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"listdevices\"},{\"key\":\"filter\",\"value\":\"{DeviceFilter}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üíª Devices in Environment",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - device-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "automator"
      },
      "name": "group - automator"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üìç Threat Intelligence Manager\n\nManage threat indicators (IOCs) in Microsoft Defender for Endpoint.\n\n### Supported Indicator Types:\n- **File Hash** - SHA1, SHA256, MD5\n- **IP Address** - IPv4 or IPv6 addresses\n- **URL/Domain** - Web addresses and domains\n- **Certificate** - Certificate thumbprints\n\n### Actions:\n- **Add Indicators** - Submit new threat indicators\n- **Remove Indicators** - Delete existing indicators\n- **View Recent** - Display recently added indicators"
            },
            "name": "text - ti-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "ti-action-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "TIAction",
                  "label": "Action",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Add\", \"Remove\", \"List\"]",
                  "defaultValue": "Add",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "ti-type-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IndicatorType",
                  "label": "Indicator Type",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"FileSha1\", \"FileSha256\", \"FileMd5\", \"IpAddress\", \"DomainName\", \"Url\", \"CertificateThumbprint\"]",
                  "defaultValue": "FileSha256",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "ti-indicators-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "Indicators",
                  "label": "Indicators (one per line or comma-separated)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Enter indicators to add or remove",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "ti-title-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IndicatorTitle",
                  "label": "Title",
                  "type": 1,
                  "isRequired": false,
                  "description": "Title for the indicator(s)",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "ti-severity-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "Severity",
                  "label": "Severity",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Informational\", \"Low\", \"Medium\", \"High\"]",
                  "defaultValue": "High",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "ti-action-type-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IndicatorAction",
                  "label": "Indicator Action",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Alert\", \"AlertAndBlock\", \"Allowed\"]",
                  "defaultValue": "AlertAndBlock",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - ti"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"path\":\"{FunctionAppUrl}/api/DefenderC2TIManager\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"{TIAction}\"},{\"key\":\"indicatorType\",\"value\":\"{IndicatorType}\"},{\"key\":\"indicators\",\"value\":\"{Indicators}\"},{\"key\":\"title\",\"value\":\"{IndicatorTitle}\"},{\"key\":\"severity\",\"value\":\"{Severity}\"},{\"key\":\"indicatorAction\",\"value\":\"{IndicatorAction}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üéØ Threat Intelligence Action: {TIAction}",
              "noDataMessage": "Click 'Run Query' to execute TI management action",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - ti-execute"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üìä Recent Indicators"
            },
            "name": "text - ti-list-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2TIManager\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"List\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üìç Threat Indicators",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - ti-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "threatintel"
      },
      "name": "group - threatintel"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## ‚öôÔ∏è Action Manager\n\nView and manage machine actions executed via MDE.\n\n### Features:\n- View recent actions and their status\n- Monitor action progress\n- Cancel pending actions\n- View action statistics and timeline"
            },
            "name": "text - actions-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "actions-refresh-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "RefreshActions",
                  "label": "Refresh Interval",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"30000\",\"label\":\"30 seconds\"},{\"value\":\"60000\",\"label\":\"1 minute\"},{\"value\":\"300000\",\"label\":\"5 minutes\"},{\"value\":\"0\",\"label\":\"Manual\"}]",
                  "defaultValue": "60000",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - actions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"GetActions\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üìä Recent Machine Actions",
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "‚úÖ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "orange",
                          "text": "‚è≥ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "yellow",
                          "text": "‚è∏Ô∏è {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "‚ùå {0}"
                        }
                      ]
                    }
                  }
                ]
              }
            },
            "name": "query - actions-list"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### ‚ö†Ô∏è Cancel All Pending Actions\n\n**WARNING**: This will cancel all pending machine actions. Use with caution."
            },
            "name": "text - cancel-warning"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"CancelAllActions\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üõë Cancel All Actions",
              "noDataMessage": "Click 'Run Query' to cancel all pending actions",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - cancel-actions"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "actions"
      },
      "name": "group - actions"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üîç Hunt Manager\n\nExecute advanced hunting queries across your MDE environment.\n\n### Features:\n- Execute KQL queries via MDE Advanced Hunting API\n- Save hunt results to storage\n- Sample queries for common scenarios\n- Results preview and export\n\n### Query Tips:\n- Use standard KQL syntax\n- Query executes against MDE Advanced Hunting tables\n- Results are limited to API response limits\n- Can save results for later analysis"
            },
            "name": "text - hunt-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "hunt-name-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntName",
                  "label": "Hunt Name",
                  "type": 1,
                  "isRequired": false,
                  "description": "Name for this hunt query",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "hunt-query-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntQuery",
                  "label": "KQL Query",
                  "type": 1,
                  "isRequired": false,
                  "description": "Enter your KQL query for advanced hunting",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "hunt-save-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "SaveToStorage",
                  "label": "Save Results to Storage",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"true\",\"label\":\"Yes\"},{\"value\":\"false\",\"label\":\"No\"}]",
                  "defaultValue": "false",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - hunt"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"path\":\"{FunctionAppUrl}/api/DefenderC2HuntManager\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"huntName\",\"value\":\"{HuntName}\"},{\"key\":\"query\",\"value\":\"{HuntQuery}\"},{\"key\":\"saveToStorage\",\"value\":\"{SaveToStorage}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üéØ Execute Hunt: {HuntName}",
              "noDataMessage": "Enter a query and click 'Run Query' to execute",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - hunt-execute"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üìù Sample Queries\n\n**Recent High Severity Alerts:**\n```kql\nAlertInfo\n| where Timestamp > ago(7d)\n| where Severity == \"High\"\n| project Timestamp, Title, Severity, Category\n| sort by Timestamp desc\n```\n\n**Suspicious Process Executions:**\n```kql\nDeviceProcessEvents\n| where Timestamp > ago(1d)\n| where ProcessCommandLine contains \"powershell\" and ProcessCommandLine contains \"invoke\"\n| project Timestamp, DeviceName, FileName, ProcessCommandLine\n| sort by Timestamp desc\n```\n\n**Network Connections to Suspicious IPs:**\n```kql\nDeviceNetworkEvents\n| where Timestamp > ago(1d)\n| where RemoteIPType == \"Public\"\n| summarize ConnectionCount = count() by RemoteIP, DeviceName\n| where ConnectionCount > 10\n| sort by ConnectionCount desc\n```"
            },
            "name": "text - sample-queries"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "hunting"
      },
      "name": "group - hunting"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üö® Incident Manager\n\nManage and view security incidents from Microsoft Defender for Endpoint.\n\n### Features:\n- View all incidents with filtering\n- Filter by severity and status\n- View incident details and statistics\n- Monitor incident trends"
            },
            "name": "text - incident-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "incident-severity-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IncidentSeverity",
                  "label": "Severity Filter",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"All\",\"label\":\"All\"},{\"value\":\"Informational\",\"label\":\"Informational\"},{\"value\":\"Low\",\"label\":\"Low\"},{\"value\":\"Medium\",\"label\":\"Medium\"},{\"value\":\"High\",\"label\":\"High\"}]",
                  "defaultValue": "All",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "incident-status-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IncidentStatus",
                  "label": "Status Filter",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"All\",\"label\":\"All\"},{\"value\":\"Active\",\"label\":\"Active\"},{\"value\":\"Resolved\",\"label\":\"Resolved\"},{\"value\":\"Redirected\",\"label\":\"Redirected\"}]",
                  "defaultValue": "Active",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - incident"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2IncidentManager\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"severity\",\"value\":\"{IncidentSeverity}\"},{\"key\":\"status\",\"value\":\"{IncidentStatus}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üìä Security Incidents",
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Informational",
                          "representation": "blue",
                          "text": "‚ÑπÔ∏è {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "green",
                          "text": "‚ö†Ô∏è {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "‚ö†Ô∏è {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "red",
                          "text": "üî¥ {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Active",
                          "representation": "orange",
                          "text": "üî¥ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Resolved",
                          "representation": "green",
                          "text": "‚úÖ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Redirected",
                          "representation": "blue",
                          "text": "‚û°Ô∏è {0}"
                        }
                      ]
                    }
                  }
                ]
              }
            },
            "name": "query - incidents"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üìà Incident Statistics\n\nStatistics and trends for security incidents."
            },
            "name": "text - stats-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2IncidentManager\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"statistics\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üìä Incident Statistics",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - incident-stats"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "incidents"
      },
      "name": "group - incidents"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üõ°Ô∏è Custom Detection Manager\n\nManage custom detection rules in Microsoft Defender for Endpoint.\n\n### Actions:\n- **List** - View all custom detection rules\n- **Create** - Create new detection rules with KQL queries\n- **Update** - Modify existing detection rules\n- **Delete** - Remove custom detection rules\n- **Backup** - Export rules for backup/migration\n\n### Rule Components:\n- Detection rule name and description\n- KQL query for detection logic\n- Severity level (Informational, Low, Medium, High)\n- Alert title and recommended actions"
            },
            "name": "text - detection-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "detection-action-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "DetectionAction",
                  "label": "Action",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"List\", \"Create\", \"Update\", \"Delete\", \"Backup\"]",
                  "defaultValue": "List",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "detection-name-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "RuleName",
                  "label": "Rule Name",
                  "type": 1,
                  "isRequired": false,
                  "description": "Name of the custom detection rule",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "detection-query-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "DetectionQuery",
                  "label": "KQL Query",
                  "type": 1,
                  "isRequired": false,
                  "description": "KQL query for the detection rule",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "detection-severity-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "DetectionSeverity",
                  "label": "Severity",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Informational\", \"Low\", \"Medium\", \"High\"]",
                  "defaultValue": "Medium",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - detection"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"path\":\"{FunctionAppUrl}/api/DefenderC2CDManager\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"{DetectionAction}\"},{\"key\":\"ruleName\",\"value\":\"{RuleName}\"},{\"key\":\"query\",\"value\":\"{DetectionQuery}\"},{\"key\":\"severity\",\"value\":\"{DetectionSeverity}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üéØ Detection Action: {DetectionAction}",
              "noDataMessage": "Select an action and click 'Run Query'",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - detection-execute"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üìù Sample Detection Rules\n\n**Suspicious PowerShell Activity:**\n```kql\nDeviceProcessEvents\n| where ProcessCommandLine contains \"powershell\" \n| where ProcessCommandLine has_any (\"invoke-expression\", \"downloadstring\", \"iex\")\n| project Timestamp, DeviceName, AccountName, ProcessCommandLine\n```\n\n**Credential Dumping Attempt:**\n```kql\nDeviceProcessEvents\n| where FileName in~ (\"mimikatz.exe\", \"procdump.exe\", \"pwdump.exe\")\n   or ProcessCommandLine has_any (\"lsass\", \"sekurlsa\")\n| project Timestamp, DeviceName, FileName, ProcessCommandLine\n```\n\n**Persistence via Registry Run Keys:**\n```kql\nDeviceRegistryEvents\n| where RegistryKey has_any (\"Run\", \"RunOnce\")\n| where ActionType == \"RegistryValueSet\"\n| project Timestamp, DeviceName, RegistryKey, RegistryValueName, RegistryValueData\n```"
            },
            "name": "text - sample-detections"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üìä Detection Statistics"
            },
            "name": "text - detection-stats-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2CDManager\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"List\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "üõ°Ô∏è Custom Detection Rules",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - detection-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "detections"
      },
      "name": "group - detections"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udda5\ufe0f Interactive Console - MDE Command Execution\n\n### Async Command Execution with Auto-Polling\n\nThis interactive console allows you to execute native MDE commands asynchronously with automatic result polling. Features:\n\n- \u2705 **Async Execution** - Commands run in the background via Function App\n- \u2705 **Auto-Polling** - Automatic status checking with configurable intervals\n- \u2705 **JSON Parsing** - Response data automatically parsed and displayed\n- \u2705 **Multi-Action Support** - Execute device actions, queries, and API calls\n- \u2705 **Result History** - Track command execution history and results\n\n---"
            },
            "name": "text - console-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "refresh-interval-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "RefreshInterval",
                  "label": "Auto Refresh Interval",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"10000\",\"label\":\"\ud83d\udfe2 10 seconds\"},{\"value\":\"30000\",\"label\":\"\ud83d\udfe2 30 seconds\"},{\"value\":\"60000\",\"label\":\"\ud83d\udfe1 1 minute\"},{\"value\":\"300000\",\"label\":\"\ud83d\udd35 5 minutes\"},{\"value\":\"0\",\"label\":\"\ud83d\udd34 Manual Only\"}]",
                  "defaultValue": "30000",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "command-type-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "CommandType",
                  "label": "Command Type",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"dispatcher\",\"label\":\"\ud83c\udfaf Device Actions (Isolate, Scan, etc.)\"},{\"value\":\"hunt\",\"label\":\"\ud83d\udd0d Advanced Hunting Query\"},{\"value\":\"ti\",\"label\":\"\ud83d\udccd Threat Intelligence\"},{\"value\":\"incident\",\"label\":\"\ud83d\udea8 Incident Management\"},{\"value\":\"detection\",\"label\":\"\ud83d\udee1\ufe0f Custom Detection\"}]",
                  "defaultValue": "dispatcher",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "action-name-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "ActionName",
                  "label": "Action/Command",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"isolate\",\"label\":\"Isolate Device\"},{\"value\":\"unisolate\",\"label\":\"Unisolate Device\"},{\"value\":\"scan\",\"label\":\"Run Antivirus Scan\"},{\"value\":\"collect\",\"label\":\"Collect Investigation Package\"},{\"value\":\"restrict\",\"label\":\"Restrict App Execution\"},{\"value\":\"unrestrict\",\"label\":\"Unrestrict App Execution\"},{\"value\":\"stopandquarantine\",\"label\":\"Stop & Quarantine File\"},{\"value\":\"runscript\",\"label\":\"Run Live Response Script\"},{\"value\":\"getfile\",\"label\":\"Get File (Live Response)\"},{\"value\":\"putfile\",\"label\":\"Put File (Live Response)\"}]",
                  "defaultValue": "isolate",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "device-ids-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "DeviceIds",
                  "label": "Target Device IDs (comma-separated)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Enter one or more device IDs separated by commas",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "command-params-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "CommandParams",
                  "label": "Additional Parameters (JSON)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Optional JSON parameters for the command",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "action-id-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "ActionId",
                  "label": "Action ID (for polling)",
                  "type": 1,
                  "isRequired": false,
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - console-config"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### \ud83d\ude80 Step 1: Execute Command\n\nClick the button below to execute the selected command. The Function App will process the request asynchronously."
            },
            "name": "text - step1-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"{CommandType}\"},{\"key\":\"actionName\",\"value\":\"{ActionName}\"},{\"key\":\"deviceIds\",\"value\":\"{DeviceIds}\"},{\"key\":\"params\",\"value\":\"{CommandParams}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 4,
              "title": "\ud83c\udfaf Command Execution Status",
              "noDataMessage": "Click 'Run Query' to execute command",
              "queryType": 12,
              "visualization": "table"
            },
            "name": "query - execute-command"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### \u23f3 Step 2: Poll for Results\n\nAutomatically polls for command completion. Refresh interval: **{RefreshInterval}ms**"
            },
            "name": "text - step2-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"getstatus\"},{\"key\":\"actionId\",\"value\":\"{ActionId}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "\ud83d\udcca Action Status (Auto-refresh)",
              "noDataMessage": "No active actions to poll. Execute a command first.",
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "orange",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "yellow",
                          "text": "\u23f8\ufe0f {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "\u274c {0}"
                        }
                      ]
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "ActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - poll-status"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### \ud83d\udce5 Step 3: View Results\n\nParsed JSON results from the command execution."
            },
            "name": "text - step3-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"getresults\"},{\"key\":\"actionId\",\"value\":\"{ActionId}\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 0,
              "title": "\ud83d\udccb Command Results",
              "noDataMessage": "No results available yet. Command may still be executing.",
              "exportToExcelOptions": "all",
              "queryType": 12,
              "visualization": "table"
            },
            "conditionalVisibility": {
              "parameterName": "ActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - results"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### \ud83d\udcda Command History\n\nRecent command executions and their status."
            },
            "name": "text - history-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{FunctionAppUrl}/api/DefenderC2Dispatcher\",\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"spnId\",\"value\":\"{SpnId}\"},{\"key\":\"action\",\"value\":\"history\"},{\"key\":\"limit\",\"value\":\"20\"}],\"batchDisabled\":false,\"transformers\":null}",
              "size": 4,
              "title": "\ud83d\udcca Execution History (Last 20)",
              "noDataMessage": "No command history available.",
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "\u274c {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "timestamp",
                    "formatter": 6
                  }
                ]
              }
            },
            "name": "query - history"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### \ud83d\udd04 How It Works\n\n**Architecture:**\n1. **Execute** \u2192 Sends command to Function App with parameters\n2. **Function App** \u2192 Authenticates with MDE API using managed identity\n3. **Poll** \u2192 Automatically checks action status at configured interval\n4. **Parse** \u2192 Extracts and displays JSON results in table format\n5. **History** \u2192 Tracks all executions for audit and review\n\n**Key Features:**\n- \u2705 Async execution - commands run in background\n- \u2705 Auto-polling - no manual status checking needed\n- \u2705 JSON parsing - structured data display\n- \u2705 Multi-tenant - works across different tenants\n- \u2705 Audit trail - complete execution history\n\n**Supported Commands:**\n- Device actions (isolate, scan, collect packages)\n- Live Response operations (run scripts, get/put files)\n- Advanced Hunting queries\n- Threat Intelligence management\n- Incident and detection operations\n\n---\n\n> \ud83d\udca1 **Tip:** Set auto-refresh to 30 seconds for active monitoring, or disable for manual control."
            },
            "name": "text - console-footer"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "console"
      },
      "name": "group - console"
    }
  ],
  "defaultResourceIds": [
    "/subscriptions/PLACEHOLDER"
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}