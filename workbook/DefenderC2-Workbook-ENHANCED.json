{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "<style>\n/* DefenderC2 Retro Terminal Theme - Matrix/Green Phosphor CRT Style */\n.workbook-content {\n    background-color: #000000 !important;\n    font-family: 'Courier New', 'Consolas', monospace !important;\n    color: #00ff00 !important;\n}\n\n/* Headers and titles */\n.workbook-content h1, \n.workbook-content h2, \n.workbook-content h3 {\n    color: #00ff00 !important;\n    text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n    border-bottom: 2px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Parameter panels and inputs */\n.workbook-content .parameter-container {\n    background-color: #001100 !important;\n    border: 1px solid #00ff00 !important;\n    padding: 10px !important;\n}\n\n.workbook-content input, \n.workbook-content select, \n.workbook-content textarea {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Tables */\n.workbook-content table {\n    background-color: #000000 !important;\n    border: 1px solid #00ff00 !important;\n}\n\n.workbook-content th {\n    background-color: #001a00 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n}\n\n.workbook-content td {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #003300 !important;\n}\n\n.workbook-content tr:hover td {\n    background-color: #001100 !important;\n}\n\n/* Buttons and links */\n.workbook-content button, \n.workbook-content .link-item {\n    background-color: #001100 !important;\n    color: #00ff00 !important;\n    border: 2px solid #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n    font-family: 'Courier New', monospace !important;\n    padding: 8px 16px !important;\n    transition: all 0.2s !important;\n}\n\n.workbook-content button:hover, \n.workbook-content .link-item:hover {\n    background-color: #00ff00 !important;\n    color: #000000 !important;\n    box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n}\n\n/* Tabs */\n.workbook-content .tab-item {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n}\n\n.workbook-content .tab-item.active {\n    background-color: #001a00 !important;\n    box-shadow: 0 0 10px #00ff00;\n}\n\n/* Code blocks and console */\n.workbook-content pre, \n.workbook-content code {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Interactive console specific styling */\n.workbook-content .console-output {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 2px solid #00ff00 !important;\n    padding: 10px !important;\n    font-family: 'Courier New', monospace !important;\n    min-height: 400px !important;\n    box-shadow: inset 0 0 20px #001100;\n}\n\n/* CRT scanline effect */\n.workbook-content::before {\n    content: \" \";\n    display: block;\n    position: fixed;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));\n    z-index: 2;\n    background-size: 100% 2px, 3px 100%;\n    pointer-events: none;\n}\n\n/* Terminal prompt cursor */\n.workbook-content .console-prompt::after {\n    content: \"\u258b\";\n    animation: blink 1s infinite;\n    color: #00ff00;\n}\n\n@keyframes blink {\n    0%, 49% { opacity: 1; }\n    50%, 100% { opacity: 0; }\n}\n\n/* Success indicators */\n.workbook-content .status-success {\n    color: #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n}\n\n/* Warning indicators */\n.workbook-content .status-warning {\n    color: #ffff00 !important;\n    text-shadow: 0 0 5px #ffff00;\n}\n\n/* Error indicators */\n.workbook-content .status-error {\n    color: #ff0000 !important;\n    text-shadow: 0 0 5px #ff0000;\n}\n\n/* Glow effect for important elements */\n.workbook-content .highlight {\n    box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00;\n}\n</style>\n\n# \ud83d\udda5\ufe0f DefenderC2 Command & Control Console\n\n> **Enterprise-grade automation and orchestration for Microsoft Defender for Endpoint**  \n> *Port of @msdirtbag/MDEAutomator with retro terminal aesthetic*\n\n---\n\n## \ud83c\udfa8 Retro Terminal Theme\n\nThis workbook features a **retro green phosphor CRT terminal theme** inspired by classic command-line interfaces.\n\n## \u26a1 Quick Start Configuration\n\nSelect your **DefenderC2 Function App** and **Workspace** - everything else autodiscovers!\n\n### What's Autodiscovered:\n- \u2705 **Subscription ID** (from Function App resource)\n- \u2705 **Resource Group** (from Function App resource)  \n- \u2705 **Function App Name** (from Function App resource)\n- \u2705 **Azure AD Tenant ID** (from Function App resource - this is where your App Registration lives!)\n- \u2705 **API Authentication** (anonymous function endpoint - no key required)\n\n### You Only Select:\n1. \ud83c\udfaf Your DefenderC2 Function App (one click)\n2. \ud83d\udcca Your Log Analytics Workspace (one click)\n\n---\n\n## \ud83d\udccb Tabs Overview\n\n| Tab | Function | Description |\n|-----|----------|-------------|\n| **\ud83c\udfaf Defender C2** | Device Actions | Isolate, scan, restrict devices |\n| **\ud83d\udee1\ufe0f Threat Intel Manager** | Indicators | Manage file/network/certificate indicators |\n| **\ud83d\udccb Action Manager** | Action Tracking | View and manage device actions |\n| **\ud83d\udd0d Hunt Manager** | Advanced Hunting | Execute KQL hunting queries |\n| **\ud83d\udea8 Incident Manager** | Incident Response | Manage security incidents |\n| **\u2699\ufe0f Custom Detection Manager** | Detection Rules | Manage custom detection rules |\n| **\ud83d\udda5\ufe0f Interactive Console** | Live Response | Shell-like command interface with async execution |\n\n---"
      },
      "name": "text - header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "fa",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionApp",
            "label": "DefenderC2 Function App",
            "type": 5,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where type == 'microsoft.web/sites' and kind == 'functionapp' | project id, name, resourceGroup, subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false,
              "resourceTypeFilter": {
                "microsoft.web/sites": true
              }
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "sub",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "rg",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = resourceGroup",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "fn",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionAppName",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = name",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "tid",
            "version": "KqlParameterItem/1.0",
            "name": "TenantId",
            "label": "Defender XDR Tenant",
            "type": 2,
            "isRequired": true,
            "isGlobal": true,
            "query": "ResourceContainers | where type == 'microsoft.resources/subscriptions' | project tenantId | distinct tenantId | project value = tenantId, label = strcat('Tenant: ', tenantId)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "selectFirstItem": true,
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "dev",
            "version": "KqlParameterItem/1.0",
            "name": "DeviceList",
            "label": "\ud83d\udda5\ufe0f Selected Devices",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Click devices below to select (auto-filters results)"
          },
          {
            "id": "fh",
            "version": "KqlParameterItem/1.0",
            "name": "FileHash",
            "label": "\ud83e\udda0 File Hash (SHA1)",
            "type": 1,
            "isGlobal": true,
            "value": ""
          },
          {
            "id": "aid",
            "version": "KqlParameterItem/1.0",
            "name": "ActionIdToCancel",
            "label": "\ud83d\uddd1\ufe0f Action ID",
            "type": 1,
            "isGlobal": true,
            "value": ""
          },
          {
            "id": "ref",
            "version": "KqlParameterItem/1.0",
            "name": "AutoRefresh",
            "label": "\ud83d\udd04 Auto Refresh",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"0\", \"label\": \"Off\"}, {\"value\": \"30000\", \"label\": \"Every 30 seconds\"}, {\"value\": \"60000\", \"label\": \"Every 1 minute\"}]",
            "value": "30000"
          },
          {
            "id": "script-name-param",
            "version": "KqlParameterItem/1.0",
            "name": "ScriptName",
            "label": "\ud83d\udcdc Selected Script",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Click scripts in Library Files to select"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "tab-devices",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83c\udfaf Device Manager",
            "subTarget": "devices",
            "style": "link"
          },
          {
            "id": "tab-ti",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udee1\ufe0f Threat Intel",
            "subTarget": "threatintel",
            "style": "link"
          },
          {
            "id": "tab-actions",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udccb Action Manager",
            "subTarget": "actions",
            "style": "link"
          },
          {
            "id": "tab-hunt",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udd0d Hunt Manager",
            "subTarget": "hunting",
            "style": "link"
          },
          {
            "id": "tab-incidents",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udea8 Incidents",
            "subTarget": "incidents",
            "style": "link"
          },
          {
            "id": "tab-detections",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\u2699\ufe0f Custom Detections",
            "subTarget": "detections",
            "style": "link"
          },
          {
            "id": "tab-console",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udda5\ufe0f Live Response Console",
            "subTarget": "console",
            "style": "link"
          }
        ]
      },
      "name": "tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83c\udfaf Device Management & Response Actions",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \ud83d\udcbb STEP 1: Device Inventory\\n\\n**Click '\u2705 Select' to add devices** | **Selected:** {DeviceList}"
            },
            "name": "inv-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get Devices\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.devices[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"ComputerName\"}, {\"path\": \"$.osPlatform\", \"columnid\": \"OS\"}, {\"path\": \"$.healthStatus\", \"columnid\": \"Health\"}, {\"path\": \"$.riskScore\", \"columnid\": \"Risk\"}, {\"path\": \"$.exposureLevel\", \"columnid\": \"Exposure\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udda5\ufe0f All Devices",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DeviceID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u2705 Select",
                      "parameterName": "DeviceList",
                      "parameterValue": "{DeviceList},{0}"
                    }
                  },
                  {
                    "columnMatch": "Health",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Active",
                          "representation": "success",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Risk",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  },
                  {
                    "columnMatch": "Exposure",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "\ud83d\udd34 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "\ud83d\udfe0 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "green",
                          "text": "\ud83d\udfe2 {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "ComputerName",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "ComputerName",
                  "sortOrder": 1
                }
              ]
            },
            "name": "inventory"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \u26a0\ufe0f STEP 2: Conflict Detection\\n\\n**\ud83c\udfaf Smart Filter:** Showing only actions for selected devices\\n\\n**Selected Devices:** {DeviceList}"
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "conflict-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.type\", \"columnid\": \"RunningAction\"}, {\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f Running Actions on Selected Devices",
              "noDataMessage": "\u2705 NO CONFLICTS - Safe to execute",
              "noDataMessageStyle": 3,
              "showRefreshButton": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "RunningAction",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "representation": "orange",
                          "text": "\u26a0\ufe0f {0} - Check before executing same action"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ActionID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "ActionIdToCancel",
                      "parameterValue": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "2",
                          "text": "\u2699\ufe0f {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "filterSettings": {
                  "defaultFilters": [
                    {
                      "columnId": "DeviceID",
                      "operator": "in",
                      "value": "{DeviceList}"
                    }
                  ]
                }
              }
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "conflict-check"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \u26a1 STEP 3: Execute ARM Actions\\n\\n**Selected Devices:** {DeviceList}\\n\\n**Azure will show confirmation dialog before execution.**"
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "arm-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "arm-scan",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd0d Run Antivirus Scan",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Run Antivirus Scan"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Run Antivirus Scan via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Run Antivirus Scan",
                    "description": "Run Antivirus Scan initiated successfully",
                    "actionName": "Run Antivirus Scan",
                    "runLabel": "Execute Run Antivirus Scan",
                    "successMessage": "\u2705 Run Antivirus Scan command sent successfully!"
                  }
                },
                {
                  "id": "arm-isolate",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd12 Isolate Device (DESTRUCTIVE)",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Isolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Isolate Device via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Isolate Device",
                    "description": "Isolate Device initiated successfully",
                    "actionName": "Isolate Device",
                    "runLabel": "Execute Isolate Device",
                    "successMessage": "\u2705 Isolate Device command sent successfully!"
                  }
                },
                {
                  "id": "arm-unisolate",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd13 Unisolate Device",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Unisolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Unisolate Device via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Unisolate Device",
                    "description": "Unisolate Device initiated successfully",
                    "actionName": "Unisolate Device",
                    "runLabel": "Execute Unisolate Device",
                    "successMessage": "\u2705 Unisolate Device command sent successfully!"
                  }
                },
                {
                  "id": "arm-collect",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udce6 Collect Investigation Package",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Collect Investigation Package"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Collect Investigation Package via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Collect Investigation Package",
                    "description": "Collect Investigation Package initiated successfully",
                    "actionName": "Collect Investigation Package",
                    "runLabel": "Execute Collect Investigation Package",
                    "successMessage": "\u2705 Collect Investigation Package command sent successfully!"
                  }
                },
                {
                  "id": "arm-restrict",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udeab Restrict App Execution (DESTRUCTIVE)",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Restrict App Execution"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Restrict App Execution via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Restrict App Execution",
                    "description": "Restrict App Execution initiated successfully",
                    "actionName": "Restrict App Execution",
                    "runLabel": "Execute Restrict App Execution",
                    "successMessage": "\u2705 Restrict App Execution command sent successfully!"
                  }
                },
                {
                  "id": "arm-unrestrict",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u2705 Unrestrict App Execution",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Unrestrict App Execution"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Unrestrict App Execution via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Unrestrict App Execution",
                    "description": "Unrestrict App Execution initiated successfully",
                    "actionName": "Unrestrict App Execution",
                    "runLabel": "Execute Unrestrict App Execution",
                    "successMessage": "\u2705 Unrestrict App Execution command sent successfully!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "arm-device-actions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \ud83e\udda0 File Quarantine\\n\\n**File Hash:** {FileHash}"
            },
            "conditionalVisibility": {
              "parameterName": "FileHash",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "file-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "arm-quarantine",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83e\udda0 Stop & Quarantine File (DESTRUCTIVE)",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Stop & Quarantine File"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "fileHash",
                        "value": "{FileHash}"
                      },
                      {
                        "key": "comment",
                        "value": "Quarantined via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Stop & Quarantine File",
                    "description": "File quarantine initiated successfully",
                    "actionName": "Stop & Quarantine File",
                    "runLabel": "Execute Quarantine",
                    "successMessage": "\u2705 File quarantine command sent successfully!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "FileHash",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "arm-file-action"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \ud83d\udcca STEP 4: Status Tracking\\n\\n**\ud83c\udfaf Smart Filter:** {DeviceList:nonempty:Showing all actions|Showing only actions for selected devices}"
            },
            "name": "status-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.type\", \"columnid\": \"Action\"}, {\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.creationDateTimeUtc\", \"columnid\": \"Started\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f Machine Actions",
              "showRefreshButton": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ActionID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "ActionIdToCancel",
                      "parameterValue": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "2",
                          "text": "\u2699\ufe0f {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "success",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "failed",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Cancelled",
                          "representation": "cancelled",
                          "text": "\ud83d\udeab {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "filterSettings": {
                  "defaultFilters": [
                    {
                      "columnId": "DeviceID",
                      "operator": "in",
                      "value": "{DeviceList}"
                    }
                  ]
                },
                "sortBy": [
                  {
                    "itemKey": "Started",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Started",
                  "sortOrder": 2
                }
              ]
            },
            "name": "all-actions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \u274c STEP 5: Cancel Action\\n\\n**Action ID:** {ActionIdToCancel}"
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "arm-cancel",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u274c Cancel Action",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Cancel Action"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "actionId",
                        "value": "{ActionIdToCancel}"
                      },
                      {
                        "key": "comment",
                        "value": "Cancelled via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Cancel Action",
                    "description": "Action cancelled successfully",
                    "actionName": "Cancel Action",
                    "runLabel": "Cancel",
                    "successMessage": "\u2705 Action cancellation command sent successfully!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "devices"
      },
      "name": "group - devices"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udee1\ufe0f Threat Intelligence Management",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udee1\ufe0f Threat Intelligence Manager\n\nManage file, IP, URL/Domain indicators for Microsoft Defender."
            },
            "name": "ti-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2TIManager\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"List All Indicators\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.indicators[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"ID\"}, {\"path\": \"$.indicatorValue\", \"columnid\": \"Indicator\"}, {\"path\": \"$.indicatorType\", \"columnid\": \"Type\"}, {\"path\": \"$.action\", \"columnid\": \"Action\"}, {\"path\": \"$.severity\", \"columnid\": \"Severity\"}, {\"path\": \"$.title\", \"columnid\": \"Title\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udccb All Threat Indicators",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "filter": true
              }
            },
            "name": "ti-list"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \ud83d\udcc4 File Indicators (SHA256)\n\nAdd or remove file hash indicators."
            },
            "name": "ti-file-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "file-hashes",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileHashes",
                  "label": "File Hashes (SHA256, comma-separated)",
                  "type": 1,
                  "value": ""
                },
                {
                  "id": "file-action",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileAction",
                  "label": "Action",
                  "type": 2,
                  "jsonData": "[\"Alert\", \"Block\", \"Allow\"]",
                  "value": "Alert"
                },
                {
                  "id": "file-severity",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileSeverity",
                  "label": "Severity",
                  "type": 2,
                  "jsonData": "[\"Low\", \"Medium\", \"High\"]",
                  "value": "Medium"
                }
              ],
              "style": "pills"
            },
            "name": "ti-file-params"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "ti-add-file",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u2795 Add File Indicators",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2TIManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add File Indicators"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "indicators",
                        "value": "{FileHashes}"
                      },
                      {
                        "key": "recommendedAction",
                        "value": "{FileAction}"
                      },
                      {
                        "key": "severity",
                        "value": "{FileSeverity}"
                      },
                      {
                        "key": "title",
                        "value": "Indicator added via DefenderC2"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Add File Indicators",
                    "description": "Adding file indicators...",
                    "runLabel": "Add Indicators"
                  }
                }
              ]
            },
            "name": "ti-file-actions"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "threatintel"
      },
      "name": "group - threatintel"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udccb Action Management & Monitoring",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udccb Action Manager\n\nView and manage all device actions across your environment."
            },
            "name": "action-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.type\", \"columnid\": \"Action\"}, {\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.creationDateTimeUtc\", \"columnid\": \"Created\"}, {\"path\": \"$.lastUpdateDateTimeUtc\", \"columnid\": \"Updated\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f All Device Actions",
              "showRefreshButton": true,
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ActionID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "ActionIdToCancel",
                      "parameterValue": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "blue",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "Default",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "action-list"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \u274c Cancel Action\n\n**Action ID to Cancel:** `{ActionIdToCancel}`"
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "cancel-action",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u274c Cancel Action",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Cancel Action"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "actionId",
                        "value": "{ActionIdToCancel}"
                      },
                      {
                        "key": "comment",
                        "value": "Cancelled via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Cancel Action",
                    "description": "Cancelling action...",
                    "runLabel": "Cancel"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-action-button"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "actions"
      },
      "name": "group - actions"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udd0d Advanced Hunting",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udd0d Advanced Hunting Manager\n\nExecute KQL queries against Microsoft Defender XDR Advanced Hunting.\n\n### Quick Start:\n1. Enter your KQL query below\n2. Click **Execute Hunt** to run\n3. Results will appear in the table below"
            },
            "name": "hunt-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "hunt-query",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntQuery",
                  "label": "KQL Query",
                  "type": 1,
                  "multiLine": true,
                  "value": "DeviceInfo\\n| take 10"
                },
                {
                  "id": "hunt-name",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntName",
                  "label": "Hunt Name",
                  "type": 1,
                  "value": "Custom Hunt Query"
                }
              ],
              "style": "pills"
            },
            "name": "hunt-params"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "execute-hunt",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd0d Execute Hunt",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2HuntManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "huntQuery",
                        "value": "{HuntQuery}"
                      },
                      {
                        "key": "huntName",
                        "value": "{HuntName}"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Execute Advanced Hunt",
                    "description": "Executing advanced hunting query...",
                    "runLabel": "Execute Hunt"
                  }
                }
              ]
            },
            "name": "hunt-execute"
          },
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udcdd Example Queries\n\n**Recent Alerts:**\n```kql\nAlertInfo\n| where Timestamp > ago(7d)\n| take 100\n```\n\n**Device Logons:**\n```kql\nDeviceLogonEvents\n| where Timestamp > ago(24h)\n| take 100\n```\n\n**File Events:**\n```kql\nDeviceFileEvents\n| where Timestamp > ago(24h)\n| take 100\n```"
            },
            "name": "hunt-examples"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "hunting"
      },
      "name": "group - hunting"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udea8 Incident Management",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udea8 Incident Manager\n\nView and manage Microsoft Defender XDR incidents."
            },
            "name": "incident-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2IncidentManager\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"GetIncidents\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.incidents[*]\", \"columns\": [{\"path\": \"$.incidentId\", \"columnid\": \"ID\"}, {\"path\": \"$.incidentName\", \"columnid\": \"Name\"}, {\"path\": \"$.severity\", \"columnid\": \"Severity\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.assignedTo\", \"columnid\": \"AssignedTo\"}, {\"path\": \"$.createdDateTime\", \"columnid\": \"Created\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udea8 Recent Incidents",
              "showRefreshButton": true,
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "\ud83d\udd34 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "\ud83d\udfe0 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "\ud83d\udd35 {0}"
                        },
                        {
                          "operator": "Default",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "incident-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "incidents"
      },
      "name": "group - incidents"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\u2699\ufe0f Custom Detection Management",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \u2699\ufe0f Custom Detection Manager\n\nManage custom detection rules in Microsoft Defender."
            },
            "name": "detection-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2CDManager\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"List All Detections\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.detections[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"ID\"}, {\"path\": \"$.displayName\", \"columnid\": \"Name\"}, {\"path\": \"$.isEnabled\", \"columnid\": \"Enabled\"}, {\"path\": \"$.severity\", \"columnid\": \"Severity\"}, {\"path\": \"$.createdDateTime\", \"columnid\": \"Created\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f Custom Detection Rules",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "filter": true
              }
            },
            "name": "detection-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "detections"
      },
      "name": "group - detections"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udda5\ufe0f Live Response Console",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udda5\ufe0f Live Response Console\n\n**Interactive command execution on devices**\n\n### Features:\n- \ud83c\udfaf Native commands (dir, cd, type, etc.)\n- \ud83d\udcdc Library script execution\n- \ud83d\udcc1 File upload/download\n- \ud83d\udcca Session management\n\n### Workflow:\n1. Select a device from Device Manager tab\n2. Choose an action below\n3. Monitor session status"
            },
            "name": "console-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Orchestrator\", \"body\": null, \"urlParams\": [{\"key\": \"Function\", \"value\": \"GetLiveResponseSessions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.sessions[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"SessionID\"}, {\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.createdDateTime\", \"columnid\": \"Created\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udd04 Active Live Response Sessions",
              "showRefreshButton": true,
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table"
            },
            "name": "console-sessions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \ud83d\udcdc Library Scripts\n\nExecute scripts from the Live Response library."
            },
            "name": "console-library-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Orchestrator\", \"body\": null, \"urlParams\": [{\"key\": \"Function\", \"value\": \"ListLibraryFiles\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.files[*]\", \"columns\": [{\"path\": \"$.fileName\", \"columnid\": \"FileName\"}, {\"path\": \"$.fileSize\", \"columnid\": \"Size\"}, {\"path\": \"$.createdTime\", \"columnid\": \"Created\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udcda Library Files",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "FileName",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u25b6\ufe0f Run",
                      "parameterName": "ScriptName",
                      "parameterValue": "{0}"
                    }
                  }
                ]
              }
            },
            "name": "console-library-list"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \u25b6\ufe0f Execute Script\n\n**Selected Device:** `{DeviceList}`  \n**Selected Script:** `{ScriptName}`"
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "console-execute-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "script-args",
                  "version": "KqlParameterItem/1.0",
                  "name": "ScriptArguments",
                  "label": "Script Arguments (optional)",
                  "type": 1,
                  "value": ""
                }
              ],
              "style": "pills"
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "console-execute-params"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "execute-script",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u25b6\ufe0f Execute Script",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Orchestrator/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "Function",
                        "value": "InvokeLiveResponseScript"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "DeviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "scriptName",
                        "value": "{ScriptName}"
                      },
                      {
                        "key": "arguments",
                        "value": "{ScriptArguments}"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Execute Live Response Script",
                    "description": "Executing script on device...",
                    "runLabel": "Execute"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "console-execute-button"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \ud83d\udca1 Console Tips\n\n**Native Commands:** Use ARM actions to execute native commands like `dir`, `cd`, `type`, etc.\n\n**Library Scripts:** Scripts are uploaded to the Live Response library and can be executed on any device.\n\n**File Operations:** Upload files to library first, then deploy to devices using PutLiveResponseFileFromLibrary.\n\n**Monitoring:** Use the sessions table above to track active Live Response sessions."
            },
            "name": "console-tips"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "console"
      },
      "name": "group - console"
    }
  ],
  "fallbackResourceIds": [],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}