{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "<style>\n/* DefenderC2 Retro Terminal Theme - Matrix/Green Phosphor CRT Style */\n.workbook-content {\n    background-color: #000000 !important;\n    font-family: 'Courier New', 'Consolas', monospace !important;\n    color: #00ff00 !important;\n}\n\n/* Headers and titles */\n.workbook-content h1, \n.workbook-content h2, \n.workbook-content h3 {\n    color: #00ff00 !important;\n    text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n    border-bottom: 2px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Parameter panels and inputs */\n.workbook-content .parameter-container {\n    background-color: #001100 !important;\n    border: 1px solid #00ff00 !important;\n    padding: 10px !important;\n}\n\n.workbook-content input, \n.workbook-content select, \n.workbook-content textarea {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Tables */\n.workbook-content table {\n    background-color: #000000 !important;\n    border: 1px solid #00ff00 !important;\n}\n\n.workbook-content th {\n    background-color: #001a00 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n}\n\n.workbook-content td {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #003300 !important;\n}\n\n.workbook-content tr:hover td {\n    background-color: #001100 !important;\n}\n\n/* Buttons and links */\n.workbook-content button, \n.workbook-content .link-item {\n    background-color: #001100 !important;\n    color: #00ff00 !important;\n    border: 2px solid #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n    font-family: 'Courier New', monospace !important;\n    padding: 8px 16px !important;\n    transition: all 0.2s !important;\n}\n\n.workbook-content button:hover, \n.workbook-content .link-item:hover {\n    background-color: #00ff00 !important;\n    color: #000000 !important;\n    box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n}\n\n/* Tabs */\n.workbook-content .tab-item {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n}\n\n.workbook-content .tab-item.active {\n    background-color: #001a00 !important;\n    box-shadow: 0 0 10px #00ff00;\n}\n\n/* Code blocks and console */\n.workbook-content pre, \n.workbook-content code {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Interactive console specific styling */\n.workbook-content .console-output {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 2px solid #00ff00 !important;\n    padding: 10px !important;\n    font-family: 'Courier New', monospace !important;\n    min-height: 400px !important;\n    box-shadow: inset 0 0 20px #001100;\n}\n\n/* CRT scanline effect */\n.workbook-content::before {\n    content: \" \";\n    display: block;\n    position: fixed;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));\n    z-index: 2;\n    background-size: 100% 2px, 3px 100%;\n    pointer-events: none;\n}\n\n/* Terminal prompt cursor */\n.workbook-content .console-prompt::after {\n    content: \"‚ñã\";\n    animation: blink 1s infinite;\n    color: #00ff00;\n}\n\n@keyframes blink {\n    0%, 49% { opacity: 1; }\n    50%, 100% { opacity: 0; }\n}\n\n/* Success indicators */\n.workbook-content .status-success {\n    color: #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n}\n\n/* Warning indicators */\n.workbook-content .status-warning {\n    color: #ffff00 !important;\n    text-shadow: 0 0 5px #ffff00;\n}\n\n/* Error indicators */\n.workbook-content .status-error {\n    color: #ff0000 !important;\n    text-shadow: 0 0 5px #ff0000;\n}\n\n/* Glow effect for important elements */\n.workbook-content .highlight {\n    box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00;\n}\n</style>\n\n# üñ•Ô∏è DefenderC2 Command & Control Console\n\n> **Enterprise-grade automation and orchestration for Microsoft Defender for Endpoint**  \n> *Port of @msdirtbag/MDEAutomator with retro terminal aesthetic*\n\n---\n\n## üé® Retro Terminal Theme\n\nThis workbook features a **retro green phosphor CRT terminal theme** inspired by classic command-line interfaces.\n\n## ‚ö° Quick Start Configuration\n\nSelect your **DefenderC2 Function App** and **Workspace** - everything else autodiscovers!\n\n### What's Autodiscovered:\n- ‚úÖ **Subscription ID** (from Function App resource)\n- ‚úÖ **Resource Group** (from Function App resource)  \n- ‚úÖ **Function App Name** (from Function App resource)\n- ‚úÖ **Azure AD Tenant ID** (from Function App resource - this is where your App Registration lives!)\n- ‚úÖ **API Authentication** (anonymous function endpoint - no key required)\n\n### You Only Select:\n1. üéØ Your DefenderC2 Function App (one click)\n2. üìä Your Log Analytics Workspace (one click)\n\n---\n\n## üìã Tabs Overview\n\n| Tab | Function | Description |\n|-----|----------|-------------|\n| **üéØ Defender C2** | Device Actions | Isolate, scan, restrict devices |\n| **üõ°Ô∏è Threat Intel Manager** | Indicators | Manage file/network/certificate indicators |\n| **üìã Action Manager** | Action Tracking | View and manage device actions |\n| **üîç Hunt Manager** | Advanced Hunting | Execute KQL hunting queries |\n| **üö® Incident Manager** | Incident Response | Manage security incidents |\n| **‚öôÔ∏è Custom Detection Manager** | Detection Rules | Manage custom detection rules |\n| **üñ•Ô∏è Interactive Console** | Live Response | Shell-like command interface with async execution |\n\n---"
      },
      "name": "text - header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "fa1-functionapp-selector",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionApp",
            "label": "DefenderC2 Function App",
            "type": 5,
            "isRequired": true,
            "query": "Resources\n| where type =~ 'microsoft.web/sites'\n| where kind contains 'functionapp'\n| project id, name, resourceGroup, subscriptionId, location, tags\n| order by name asc",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": null,
            "description": "Select your DefenderC2 Function App from the list of available Function Apps in your subscription(s).",
            "isGlobal": true
          },
          {
            "id": "fa2-workspace-selector",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "label": "Log Analytics Workspace",
            "type": 5,
            "isRequired": true,
            "query": "Resources\n| where type =~ 'microsoft.operationalinsights/workspaces'\n| project id, name, resourceGroup, location\n| order by name asc",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": null,
            "description": "Select your Log Analytics Workspace (for Sentinel data and dashboards).",
            "isGlobal": true
          },
          {
            "id": "ad1-subscription-autodiscover",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "label": "Subscription (Auto)",
            "type": 1,
            "isRequired": true,
            "query": "Resources\n| where id == '{FunctionApp}'\n| project value = subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "description": "Auto-discovered from selected Function App",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ],
            "isGlobal": true
          },
          {
            "id": "ad2-resourcegroup-autodiscover",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "label": "Resource Group (Auto)",
            "type": 1,
            "isRequired": true,
            "query": "Resources\n| where id == '{FunctionApp}'\n| project value = resourceGroup",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "description": "Auto-discovered from selected Function App",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ],
            "isGlobal": true
          },
          {
            "id": "ad3-functionappname-autodiscover",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionAppName",
            "label": "Function App Name (Auto)",
            "type": 1,
            "isRequired": true,
            "query": "Resources\n| where id == '{FunctionApp}'\n| project value = name",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "description": "Auto-discovered from selected Function App",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ],
            "isGlobal": true
          },
          {
            "id": "ad4-tenantid-autodiscover",
            "version": "KqlParameterItem/1.0",
            "name": "TenantId",
            "label": "Azure AD Tenant ID (Auto)",
            "type": 1,
            "isRequired": true,
            "query": "Resources\n| where id == '{FunctionApp}'\n| project value = tenantId",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "isSearchable": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "description": "Auto-discovered from Function App resource. This is the Azure AD Tenant ID where your App Registration is registered.",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ],
            "isGlobal": true
          },
          {
            "id": "selected-tab-parameter",
            "version": "KqlParameterItem/1.0",
            "name": "selectedTab",
            "label": "Selected Tab (internal)",
            "type": 1,
            "isRequired": false,
            "value": "automator",
            "query": "",
            "queryType": 0,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "isSearchable": false
            }
          },
          {
            "id": "devicelist-parameter",
            "version": "KqlParameterItem/1.0",
            "name": "DeviceList",
            "label": "Available Devices (Auto-populated)",
            "type": 2,
            "isRequired": false,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"value\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"label\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionAppName}"
              },
              {
                "criterionType": "param",
                "value": "{TenantId}"
              }
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 10,
            "description": "‚úÖ Auto-populated from your Defender environment using autodiscovered tenant ID and function app. Refresh automatically when Function App or Tenant ID changes.",
            "value": null
          },
          {
            "id": "b2f8g6b-d9fg-7975-c2g3-5h5h8g0e6f4d",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 2592000000
            }
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - configuration"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "4e8c3d7a-2b1f-4a8d-9e5c-1a2b3c4d5e6f",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Defender C2",
            "subTarget": "automator",
            "style": "link"
          },
          {
            "id": "5f9d4e8b-3c2g-5b9e-0f6d-2b3c4d5e6f7g",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Threat Intel Manager",
            "subTarget": "threatintel",
            "style": "link"
          },
          {
            "id": "6g0e5f9c-4d3h-6c0f-1g7e-3c4d5e6f7g8h",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Action Manager",
            "subTarget": "actions",
            "style": "link"
          },
          {
            "id": "7h1f6g0d-5e4i-7d1g-2h8f-4d5e6f7g8h9i",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Hunt Manager",
            "subTarget": "hunting",
            "style": "link"
          },
          {
            "id": "8i2g7h1e-6f5j-8e2h-3i9g-5e6f7g8h9i0j",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Incident Manager",
            "subTarget": "incidents",
            "style": "link"
          },
          {
            "id": "9j3h8i2f-7g6k-9f3i-4j0h-6f7g8h9i0j1k",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Custom Detection Manager",
            "subTarget": "detections",
            "style": "link"
          },
          {
            "id": "0k4i9j3g-8h7m-1h5k-6l2j-8h9i0j1k2l3m",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "üñ•Ô∏è Interactive Console",
            "subTarget": "console",
            "style": "link"
          }
        ]
      },
      "name": "links - tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "üéØ Device Actions",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Defender C2 - Device Response Actions\n\nPerform Microsoft Defender for Endpoint response actions with **ARM Actions** and **JSONPath parsing**.\n\n### Features:\n- ‚úÖ Azure Resource Graph auto-discovery\n- ‚úÖ ARM Actions for synchronous operations\n- ‚úÖ JSONPath output parsing\n- ‚úÖ Multi-tenancy support with automatic TenantId injection\n- ‚úÖ Anonymous function authentication (no keys needed)"
            },
            "name": "text - automator-intro"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üö® Isolate Device\n\nIsolate devices from the network using ARM Actions with JSONPath transformers."
            },
            "name": "text - isolate-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "isolate-deviceids",
                  "version": "KqlParameterItem/1.0",
                  "name": "IsolateDeviceIds",
                  "label": "Device IDs (comma-separated)",
                  "type": 2,
                  "isRequired": false,
                  "description": "Select one or more devices. List is auto-populated from Defender environment.",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"value\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"label\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
                  "queryType": 10,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    }
                  ],
                  "value": null,
                  "isGlobal": true
                },
                {
                  "id": "isolate-type",
                  "version": "KqlParameterItem/1.0",
                  "name": "IsolationType",
                  "label": "Isolation Type",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Full\", \"Selective\"]",
                  "defaultValue": "Full",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - isolate"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "isolate-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üö® Isolate Devices",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Isolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "isolationType",
                        "value": "{IsolationType}"
                      },
                      {
                        "key": "comment",
                        "value": "Isolated via Workbook"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Isolate Devices",
                    "description": "Initiating device isolation...",
                    "actionName": "Isolate",
                    "runLabel": "Isolate Devices"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{DeviceList}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{IsolationType}"
                    }
                  ]
                }
              ]
            },
            "name": "links - isolate-action"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$\",\"columns\":[{\"path\":\"$.actionId\",\"columnid\":\"actionId\"},{\"path\":\"$.status\",\"columnid\":\"status\"},{\"path\":\"$.message\",\"columnid\":\"message\"},{\"path\":\"$.tenantId\",\"columnid\":\"tenantId\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Isolate Device\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"deviceIds\",\"value\":\"{IsolateDeviceIds}\"}]}",
              "size": 0,
              "title": "Isolation Result",
              "queryType": 10,
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "IsolateDeviceIds",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - isolate-result"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üîì Unisolate Device\n\nRemove network isolation from devices."
            },
            "name": "text - unisolate-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "unisolate-deviceids",
                  "version": "KqlParameterItem/1.0",
                  "name": "UnisolateDeviceIds",
                  "label": "Device IDs (comma-separated)",
                  "type": 2,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"value\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"label\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
                  "queryType": 10,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "description": "Select one or more devices. List is auto-populated from Defender environment.",
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    }
                  ],
                  "value": null,
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - unisolate"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "unisolate-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üîì Unisolate Devices",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Unisolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Unisolated via Workbook"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Unisolate Devices",
                    "description": "Removing device isolation...",
                    "actionName": "Unisolate",
                    "runLabel": "Unisolate Devices"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{DeviceList}"
                    }
                  ]
                }
              ]
            },
            "name": "links - unisolate-action"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üõ°Ô∏è Restrict App Execution\n\nRestrict app execution to Microsoft-signed binaries only."
            },
            "name": "text - restrict-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "restrict-deviceids",
                  "version": "KqlParameterItem/1.0",
                  "name": "RestrictDeviceIds",
                  "label": "Device IDs (comma-separated)",
                  "type": 2,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"value\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"label\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
                  "queryType": 10,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "description": "Select one or more devices. List is auto-populated from Defender environment.",
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    }
                  ],
                  "value": null,
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - restrict"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "restrict-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üõ°Ô∏è Restrict App Execution",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Restrict App Execution"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "App execution restricted via Workbook"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Restrict App Execution",
                    "description": "Restricting application execution...",
                    "actionName": "Restrict",
                    "runLabel": "Restrict Apps"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{DeviceList}"
                    }
                  ]
                }
              ]
            },
            "name": "links - restrict-action"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üîç Run Antivirus Scan\n\nExecute a full antivirus scan on devices."
            },
            "name": "text - scan-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "scan-deviceids",
                  "version": "KqlParameterItem/1.0",
                  "name": "ScanDeviceIds",
                  "label": "Device IDs (comma-separated)",
                  "type": 2,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"value\"},{\"path\":\"$.computerDnsName\",\"columnid\":\"label\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
                  "queryType": 10,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "description": "Select one or more devices. List is auto-populated from Defender environment.",
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    }
                  ],
                  "value": null,
                  "isGlobal": true
                },
                {
                  "id": "scan-type",
                  "version": "KqlParameterItem/1.0",
                  "name": "ScanType",
                  "label": "Scan Type",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Quick\", \"Full\"]",
                  "defaultValue": "Full",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - scan"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "scan-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üîç Run Antivirus Scan",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Run Antivirus Scan"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "scanType",
                        "value": "{ScanType}"
                      },
                      {
                        "key": "comment",
                        "value": "Scan initiated via Workbook"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Run Antivirus Scan",
                    "description": "Starting antivirus scan...",
                    "actionName": "Scan",
                    "runLabel": "Run Scan"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{DeviceList}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ScanType}"
                    }
                  ]
                }
              ]
            },
            "name": "links - scan-action"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üíª Get Devices\n\nRetrieve device list with JSONPath parsing."
            },
            "name": "text - getdevices-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.devices[*]\",\"columns\":[{\"path\":\"$.deviceName\",\"columnid\":\"Device Name\"},{\"path\":\"$.riskScore\",\"columnid\":\"Risk Score\"},{\"path\":\"$.healthStatus\",\"columnid\":\"Health Status\"},{\"path\":\"$.lastIpAddress\",\"columnid\":\"Last IP\"},{\"path\":\"$.lastSeen\",\"columnid\":\"Last Seen\"},{\"path\":\"$.id\",\"columnid\":\"Device ID\"}]}}],\"body\":null,\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Devices\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
              "size": 0,
              "title": "üíª Device List",
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - get-devices"
          }
        ]
      },
      "name": "group - automator"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "üìç Threat Intelligence Manager",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üìç Threat Intelligence Manager\n\nManage threat indicators (IOCs) in Microsoft Defender for Endpoint with **ARM Actions** and **JSONPath parsing**.\n\n### Features:\n- ‚úÖ Batch indicator submission (File/IP/URL/Domain)\n- ‚úÖ ARM Actions for synchronous operations\n- ‚úÖ JSONPath output parsing\n- ‚úÖ Multi-tenancy support"
            },
            "name": "text - ti-intro"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üìÑ Add File Indicators (Batch)\n\nSubmit multiple file hashes at once with ARM Actions."
            },
            "name": "text - file-indicators"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "file-indicators-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileIndicators",
                  "label": "File Hashes (comma-separated)",
                  "type": 1,
                  "isRequired": false,
                  "description": "SHA1, SHA256, or MD5 hashes separated by commas",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "file-action-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileIndicatorAction",
                  "label": "Action",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Alert\", \"AlertAndBlock\", \"Allowed\"]",
                  "defaultValue": "AlertAndBlock",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "file-severity-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileSeverity",
                  "label": "Severity",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Informational\", \"Low\", \"Medium\", \"High\"]",
                  "defaultValue": "High",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "file-title-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileTitle",
                  "label": "Title",
                  "type": 1,
                  "isRequired": false,
                  "description": "Title for these indicators",
                  "value": "Malicious files",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "file-desc-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileDescription",
                  "label": "Description",
                  "type": 1,
                  "isRequired": false,
                  "description": "Description for these indicators",
                  "value": "Known malware hashes",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - file-indicators"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "file-add-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üìÑ Add File Indicators",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2TIManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add File Indicators"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "indicators",
                        "value": "{FileIndicators}"
                      },
                      {
                        "key": "indicatorAction",
                        "value": "{FileIndicatorAction}"
                      },
                      {
                        "key": "severity",
                        "value": "{FileSeverity}"
                      },
                      {
                        "key": "title",
                        "value": "{FileTitle}"
                      },
                      {
                        "key": "description",
                        "value": "{FileDescription}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Add File Indicators",
                    "description": "Adding file indicators to MDE...",
                    "actionName": "AddFileIndicators",
                    "runLabel": "Add Indicators"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FileIndicators}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FileIndicatorAction}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FileSeverity}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FileTitle}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FileDescription}"
                    }
                  ]
                }
              ]
            },
            "name": "links - file-add"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üåê Add IP Indicators (Batch)\n\nSubmit multiple IP addresses at once."
            },
            "name": "text - ip-indicators"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "ip-indicators-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IpIndicators",
                  "label": "IP Addresses (comma-separated)",
                  "type": 1,
                  "isRequired": false,
                  "description": "IPv4 or IPv6 addresses separated by commas",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "ip-action-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IpIndicatorAction",
                  "label": "Action",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Alert\", \"AlertAndBlock\", \"Allowed\"]",
                  "defaultValue": "AlertAndBlock",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "ip-severity-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IpSeverity",
                  "label": "Severity",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Informational\", \"Low\", \"Medium\", \"High\"]",
                  "defaultValue": "High",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - ip-indicators"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "ip-add-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üåê Add IP Indicators",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2TIManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add IP Indicators"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "indicators",
                        "value": "{IpIndicators}"
                      },
                      {
                        "key": "indicatorAction",
                        "value": "{IpIndicatorAction}"
                      },
                      {
                        "key": "severity",
                        "value": "{IpSeverity}"
                      },
                      {
                        "key": "title",
                        "value": "Malicious IPs"
                      },
                      {
                        "key": "description",
                        "value": "Known malicious IP addresses"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Add IP Indicators",
                    "description": "Adding IP indicators to MDE...",
                    "actionName": "AddIpIndicators",
                    "runLabel": "Add Indicators"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{IpIndicators}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{IpIndicatorAction}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{IpSeverity}"
                    }
                  ]
                }
              ]
            },
            "name": "links - ip-add"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üîó Add URL/Domain Indicators (Batch)\n\nSubmit multiple URLs or domains at once."
            },
            "name": "text - url-indicators"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "url-indicators-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "UrlIndicators",
                  "label": "URLs/Domains (comma-separated)",
                  "type": 1,
                  "isRequired": false,
                  "description": "URLs or domain names separated by commas",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "url-action-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "UrlIndicatorAction",
                  "label": "Action",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Alert\", \"AlertAndBlock\", \"Allowed\"]",
                  "defaultValue": "AlertAndBlock",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - url-indicators"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "url-add-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üîó Add URL/Domain Indicators",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2TIManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add URL Indicators"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "indicators",
                        "value": "{UrlIndicators}"
                      },
                      {
                        "key": "indicatorAction",
                        "value": "{UrlIndicatorAction}"
                      },
                      {
                        "key": "severity",
                        "value": "High"
                      },
                      {
                        "key": "title",
                        "value": "Malicious URLs"
                      },
                      {
                        "key": "description",
                        "value": "Known malicious URLs and domains"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Add URL/Domain Indicators",
                    "description": "Adding URL/domain indicators to MDE...",
                    "actionName": "AddUrlIndicators",
                    "runLabel": "Add Indicators"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{UrlIndicators}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{UrlIndicatorAction}"
                    }
                  ]
                }
              ]
            },
            "name": "links - url-add"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üìä List All Indicators\n\nView all threat indicators with JSONPath parsing."
            },
            "name": "text - list-indicators"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2TIManager\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.indicators[*]\",\"columns\":[{\"path\":\"$.indicatorValue\",\"columnid\":\"Indicator\"},{\"path\":\"$.indicatorType\",\"columnid\":\"Type\"},{\"path\":\"$.action\",\"columnid\":\"Action\"},{\"path\":\"$.severity\",\"columnid\":\"Severity\"},{\"path\":\"$.title\",\"columnid\":\"Title\"},{\"path\":\"$.createdBy\",\"columnid\":\"Created By\"},{\"path\":\"$.creationDateTime\",\"columnid\":\"Created\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"List Indicators\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
              "size": 0,
              "title": "üìç Active Threat Indicators",
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - list-indicators"
          }
        ]
      },
      "name": "group - threatintel"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "‚öôÔ∏è Action Manager",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## ‚öôÔ∏è Action Manager\n\nView and manage machine actions with **auto-refresh** and **JSONPath parsing**.\n\n### Features:\n- ‚úÖ Auto-refresh with configurable intervals\n- ‚úÖ JSONPath output parsing\n- ‚úÖ Status filtering\n- ‚úÖ Cancel actions via ARM Actions"
            },
            "name": "text - actions-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "actions-status-filter",
                  "version": "KqlParameterItem/1.0",
                  "name": "StatusFilter",
                  "label": "Status Filter",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"All\", \"Pending\", \"InProgress\", \"Succeeded\", \"Failed\"]",
                  "defaultValue": "All",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "actions-refresh-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "RefreshInterval",
                  "label": "Auto-Refresh",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"10\", \"30\", \"60\", \"300\"]",
                  "defaultValue": "30",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - actions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üìä Get All Actions\n\nView all machine actions with auto-refresh enabled."
            },
            "name": "text - get-actions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.actions[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"Action ID\"},{\"path\":\"$.type\",\"columnid\":\"Type\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.requestor\",\"columnid\":\"Requestor\"},{\"path\":\"$.creationDateTimeUtc\",\"columnid\":\"Created\"},{\"path\":\"$.machineId\",\"columnid\":\"Device ID\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Actions\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
              "size": 0,
              "title": "üìä Machine Actions (Auto-refreshing every {RefreshInterval}s)",
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "‚úÖ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "orange",
                          "text": "‚è≥ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "yellow",
                          "text": "‚è∏Ô∏è {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "‚ùå {0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              },
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - actions-list",
            "isAutoRefreshEnabled": true,
            "autoRefreshSettings": {
              "intervalInSeconds": 30,
              "refreshCondition": "always"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üîç Get Action Status\n\nRetrieve status of a specific action."
            },
            "name": "text - action-status"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "action-id-param",
                  "version": "KqlParameterItem/1.0",
                  "name": "ActionId",
                  "label": "Action ID",
                  "type": 1,
                  "isRequired": false,
                  "description": "Enter specific action ID to query",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - action-id"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"Action ID\"},{\"path\":\"$.type\",\"columnid\":\"Type\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.requestor\",\"columnid\":\"Requestor\"},{\"path\":\"$.creationDateTimeUtc\",\"columnid\":\"Created\"},{\"path\":\"$.lastUpdateDateTimeUtc\",\"columnid\":\"Last Updated\"},{\"path\":\"$.error\",\"columnid\":\"Error\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Action Status\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"actionId\",\"value\":\"{ActionId}\"}]}",
              "size": 0,
              "title": "Action Details",
              "queryType": 10,
              "isAutoRefreshEnabled": true,
              "autoRefreshSettings": {
                "intervalInSeconds": 30,
                "runOnLoad": true
              },
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - action-status"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üõë Cancel Action\n\nCancel a specific pending action."
            },
            "name": "text - cancel-action"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "cancel-action-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "CancelActionId",
                  "label": "Action ID to Cancel",
                  "type": 1,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - cancel-action"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "cancel-action-link",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üõë Cancel Action",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Cancel Action"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "actionId",
                        "value": "{CancelActionId}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Cancel Action",
                    "description": "Cancelling machine action...",
                    "actionName": "CancelAction",
                    "runLabel": "Cancel"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{CancelActionId}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "CancelActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "links - cancel-action"
          }
        ]
      },
      "name": "group - actions"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "üîç Hunt Manager",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üîç Hunt Manager\n\nExecute advanced hunting queries with **async polling** and **JSONPath parsing**.\n\n### Features:\n- ‚úÖ Async hunt execution with auto-refresh\n- ‚úÖ JSONPath result parsing\n- ‚úÖ Sample query templates\n- ‚úÖ Export to Excel capability"
            },
            "name": "text - hunt-intro"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üìù Sample Queries\n\nSelect a sample query or enter your own KQL."
            },
            "name": "text - sample-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "sample-query-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "SampleQuery",
                  "label": "Sample Queries",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"DeviceEvents | where Timestamp > ago(24h) | where ActionType == 'ProcessCreated' | take 100\",\"label\":\"Recent Process Creations\"},{\"value\":\"AlertInfo | where Timestamp > ago(7d) | where Severity == 'High' | project Timestamp, Title, Severity, Category\",\"label\":\"High Severity Alerts\"},{\"value\":\"DeviceNetworkEvents | where Timestamp > ago(1d) | where RemoteIPType == 'Public' | summarize Count=count() by RemoteIP, DeviceName\",\"label\":\"Public Network Connections\"},{\"value\":\"DeviceFileEvents | where Timestamp > ago(1d) | where FileName endswith '.exe' | project Timestamp, DeviceName, FileName, FolderPath\",\"label\":\"Recent EXE Files\"},{\"value\":\"DeviceLogonEvents | where Timestamp > ago(1d) | where ActionType == 'LogonFailed' | summarize FailedAttempts=count() by DeviceName, AccountName\",\"label\":\"Failed Logon Attempts\"}]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - sample-queries"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "hunt-query-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntQuery",
                  "label": "KQL Query (or use sample above)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Enter your KQL query or select from samples",
                  "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "kql",
                    "multiLineHeight": 10
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "{SampleQuery}"
                },
                {
                  "id": "hunt-refresh-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntRefreshInterval",
                  "label": "Auto-Refresh Interval",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"10\", \"30\", \"60\"]",
                  "defaultValue": "30",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - hunt-query"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üéØ Execute Hunt\n\nRun your hunt query with automatic result polling."
            },
            "name": "text - execute-hunt"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2HuntManager\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.results[*]\",\"columns\":[{\"path\":\"$.DeviceName\",\"columnid\":\"Device Name\"},{\"path\":\"$.Timestamp\",\"columnid\":\"Timestamp\"},{\"path\":\"$.ActionType\",\"columnid\":\"Action Type\"},{\"path\":\"$.FileName\",\"columnid\":\"File Name\"},{\"path\":\"$.ProcessCommandLine\",\"columnid\":\"Command Line\"},{\"path\":\"$.AccountName\",\"columnid\":\"Account\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Execute Hunt\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"huntQuery\",\"value\":\"{HuntQuery}\"}]}",
              "size": 0,
              "title": "üîç Hunt Results (Auto-refreshing every {HuntRefreshInterval}s until complete)",
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "HuntQuery",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - hunt-results"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üìä Hunt Status\n\nMonitor the status of your hunt query execution."
            },
            "name": "text - hunt-status"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2HuntManager\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$\",\"columns\":[{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.rowCount\",\"columnid\":\"Rows\"},{\"path\":\"$.executionTime\",\"columnid\":\"Execution Time\"},{\"path\":\"$.message\",\"columnid\":\"Message\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Hunt Status\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
              "size": 0,
              "title": "Hunt Execution Status",
              "queryType": 10,
              "isAutoRefreshEnabled": true,
              "autoRefreshSettings": {
                "intervalInSeconds": 30,
                "runOnLoad": true,
                "refreshCondition": "$.status != 'Completed'"
              },
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "HuntQuery",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - hunt-status",
            "isAutoRefreshEnabled": true,
            "autoRefreshSettings": {
              "intervalInSeconds": 30,
              "refreshCondition": "always"
            }
          }
        ]
      },
      "name": "group - hunting"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "üö® Incident Manager",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üö® Incident Manager\n\nManage security incidents with **filters** and **JSONPath parsing**.\n\n### Features:\n- ‚úÖ Severity and status filtering\n- ‚úÖ JSONPath output parsing\n- ‚úÖ Update incidents via ARM Actions\n- ‚úÖ Add comments to incidents"
            },
            "name": "text - incident-intro"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "incident-severity-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IncidentSeverity",
                  "label": "Severity Filter",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"All\", \"Informational\", \"Low\", \"Medium\", \"High\"]",
                  "defaultValue": "All",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "incident-status-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IncidentStatus",
                  "label": "Status Filter",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"All\", \"Active\", \"Resolved\", \"InProgress\", \"Redirected\"]",
                  "defaultValue": "Active",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - incident-filters"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üìä Get Incidents\n\nView incidents with filtering options."
            },
            "name": "text - get-incidents"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2IncidentManager\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.incidents[*]\",\"columns\":[{\"path\":\"$.incidentId\",\"columnid\":\"Incident ID\"},{\"path\":\"$.incidentName\",\"columnid\":\"Name\"},{\"path\":\"$.severity\",\"columnid\":\"Severity\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.assignedTo\",\"columnid\":\"Assigned To\"},{\"path\":\"$.createdTime\",\"columnid\":\"Created\"},{\"path\":\"$.lastUpdateTime\",\"columnid\":\"Updated\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Get Incidents\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"severity\",\"value\":\"{IncidentSeverity}\"},{\"key\":\"status\",\"value\":\"{IncidentStatus}\"}]}",
              "size": 0,
              "title": "üö® Security Incidents",
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "red",
                          "text": "üî¥ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "‚ö†Ô∏è {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "green",
                          "text": "‚ÑπÔ∏è {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Active",
                          "representation": "red",
                          "text": "üî¥ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Resolved",
                          "representation": "green",
                          "text": "‚úÖ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "orange",
                          "text": "‚è≥ {0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              },
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - incidents"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## ‚úèÔ∏è Update Incident\n\nUpdate incident status or assignment."
            },
            "name": "text - update-incident"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "update-incident-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "UpdateIncidentId",
                  "label": "Incident ID",
                  "type": 1,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "update-status-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "UpdateStatus",
                  "label": "New Status",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Active\", \"Resolved\", \"InProgress\", \"Redirected\"]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - update-incident"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "update-incident-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "‚úèÔ∏è Update Incident",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2IncidentManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Update Incident"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "incidentId",
                        "value": "{UpdateIncidentId}"
                      },
                      {
                        "key": "status",
                        "value": "{UpdateStatus}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Update Incident",
                    "description": "Updating incident status...",
                    "actionName": "UpdateIncident",
                    "runLabel": "Update"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{UpdateIncidentId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{UpdateStatus}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "UpdateIncidentId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "links - update-incident"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üí¨ Add Comment to Incident\n\nAdd a comment to an existing incident."
            },
            "name": "text - add-comment"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "comment-incident-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "CommentIncidentId",
                  "label": "Incident ID",
                  "type": 1,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "incident-comment-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "IncidentComment",
                  "label": "Comment",
                  "type": 1,
                  "isRequired": false,
                  "typeSettings": {
                    "multiLineText": true,
                    "multiLineHeight": 5
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - add-comment"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "add-comment-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üí¨ Add Comment",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2IncidentManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add Comment"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "incidentId",
                        "value": "{CommentIncidentId}"
                      },
                      {
                        "key": "comment",
                        "value": "{IncidentComment}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Add Comment",
                    "description": "Adding comment to incident...",
                    "actionName": "AddComment",
                    "runLabel": "Add"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{CommentIncidentId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{IncidentComment}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "CommentIncidentId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "links - add-comment"
          }
        ]
      },
      "name": "group - incidents"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "üõ°Ô∏è Custom Detection Manager",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üõ°Ô∏è Custom Detection Manager\n\nManage custom detection rules with **ARM Actions** and **JSONPath parsing**.\n\n### Features:\n- ‚úÖ List all detections with JSONPath\n- ‚úÖ Create/Update/Delete via ARM Actions\n- ‚úÖ Backup detections for migration\n- ‚úÖ Sample detection templates"
            },
            "name": "text - detection-intro"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üìã List All Detections\n\nView all custom detection rules with JSONPath parsing."
            },
            "name": "text - list-detections"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2CDManager\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.detections[*]\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"ID\"},{\"path\":\"$.displayName\",\"columnid\":\"Name\"},{\"path\":\"$.severity\",\"columnid\":\"Severity\"},{\"path\":\"$.enabled\",\"columnid\":\"Enabled\"},{\"path\":\"$.createdBy\",\"columnid\":\"Created By\"},{\"path\":\"$.lastModified\",\"columnid\":\"Modified\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"List Detections\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
              "size": 0,
              "title": "üõ°Ô∏è Custom Detection Rules",
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - list-detections"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## ‚ûï Create Detection Rule\n\nCreate a new custom detection rule."
            },
            "name": "text - create-detection"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "create-rule-name",
                  "version": "KqlParameterItem/1.0",
                  "name": "CreateRuleName",
                  "label": "Rule Name",
                  "type": 1,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "create-rule-query",
                  "version": "KqlParameterItem/1.0",
                  "name": "CreateRuleQuery",
                  "label": "KQL Query",
                  "type": 1,
                  "isRequired": false,
                  "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "kql",
                    "multiLineHeight": 10
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "create-rule-severity",
                  "version": "KqlParameterItem/1.0",
                  "name": "CreateRuleSeverity",
                  "label": "Severity",
                  "type": 2,
                  "isRequired": false,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Informational\", \"Low\", \"Medium\", \"High\"]",
                  "defaultValue": "Medium",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - create-detection"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "create-detection-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "‚ûï Create Detection Rule",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2CDManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Create Detection"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "ruleName",
                        "value": "{CreateRuleName}"
                      },
                      {
                        "key": "query",
                        "value": "{CreateRuleQuery}"
                      },
                      {
                        "key": "severity",
                        "value": "{CreateRuleSeverity}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Create Detection Rule",
                    "description": "Creating custom detection rule...",
                    "actionName": "CreateDetection",
                    "runLabel": "Create"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{CreateRuleName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{CreateRuleQuery}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{CreateRuleSeverity}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "CreateRuleName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "links - create-detection"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## ‚úèÔ∏è Update Detection Rule\n\nModify an existing detection rule."
            },
            "name": "text - update-detection"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "update-rule-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "UpdateRuleId",
                  "label": "Rule ID",
                  "type": 1,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "update-rule-query",
                  "version": "KqlParameterItem/1.0",
                  "name": "UpdateRuleQuery",
                  "label": "New KQL Query",
                  "type": 1,
                  "isRequired": false,
                  "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "kql",
                    "multiLineHeight": 10
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - update-detection"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "update-detection-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "‚úèÔ∏è Update Detection Rule",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2CDManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Update Detection"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "ruleId",
                        "value": "{UpdateRuleId}"
                      },
                      {
                        "key": "query",
                        "value": "{UpdateRuleQuery}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Update Detection Rule",
                    "description": "Updating detection rule...",
                    "actionName": "UpdateDetection",
                    "runLabel": "Update"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{UpdateRuleId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{UpdateRuleQuery}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "UpdateRuleId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "links - update-detection"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## ‚ùå Delete Detection Rule\n\nRemove a custom detection rule."
            },
            "name": "text - delete-detection"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "delete-rule-id",
                  "version": "KqlParameterItem/1.0",
                  "name": "DeleteRuleId",
                  "label": "Rule ID to Delete",
                  "type": 1,
                  "isRequired": false,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - delete-detection"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "delete-detection-action",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "‚ùå Delete Detection Rule",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2CDManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Delete Detection"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "ruleId",
                        "value": "{DeleteRuleId}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Delete Detection Rule",
                    "description": "Deleting detection rule...",
                    "actionName": "DeleteDetection",
                    "runLabel": "Delete"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{DeleteRuleId}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeleteRuleId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "links - delete-detection"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n## üíæ Backup Detections\n\nExport all detection rules for backup or migration."
            },
            "name": "text - backup-detections"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2CDManager\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.backup[*]\",\"columns\":[{\"path\":\"$.displayName\",\"columnid\":\"Name\"},{\"path\":\"$.query\",\"columnid\":\"Query\"},{\"path\":\"$.severity\",\"columnid\":\"Severity\"}]}}],\"urlParams\":[{\"key\":\"action\",\"value\":\"Backup Detections\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"}]}",
              "size": 0,
              "title": "üíæ Detection Backup",
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - backup-detections"
          }
        ]
      },
      "name": "group - detections"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## üñ•Ô∏è Interactive Console - Live Response Command Execution\n\n### üéØ Shell-Like Interface with Async Execution\n\n<div style=\"background-color: #000000; color: #00ff00; border: 2px solid #00ff00; padding: 20px; font-family: 'Courier New', monospace; box-shadow: 0 0 20px #001100;\">\n\n```\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë                    DefenderC2 Interactive Live Response Shell                ‚ïë\n‚ïë                          Port of @msdirtbag/MDEAutomator                     ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n\n SYSTEM STATUS: OPERATIONAL\n CONNECTION: ACTIVE\n AUTH: MULTI-TENANT APP REGISTRATION\n MODE: ASYNC EXECUTION WITH AUTO-POLLING\n\n‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ\n‚îÇ FEATURES                                                                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ ‚úÖ Async Command Execution      ‚îÇ Commands run in background via Function  ‚îÇ\n‚îÇ ‚úÖ Auto-Polling Results         ‚îÇ Automatic status checking (configurable) ‚îÇ\n‚îÇ ‚úÖ JSON Response Parsing        ‚îÇ Structured output display                ‚îÇ\n‚îÇ ‚úÖ Multi-Action Support         ‚îÇ Device actions, queries, API calls       ‚îÇ\n‚îÇ ‚úÖ Execution History Tracking   ‚îÇ Command audit trail                      ‚îÇ\n‚îÇ ‚úÖ Library File Operations      ‚îÇ Upload, deploy, download files           ‚îÇ\n‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ\n\n‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ\n‚îÇ AVAILABLE COMMAND TYPES                                                     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ üéØ DefenderC2Dispatcher    ‚îÇ Device actions (Isolate, Scan, Restrict)    ‚îÇ\n‚îÇ üîç DefenderC2HuntManager   ‚îÇ Advanced Hunting (KQL queries)              ‚îÇ\n‚îÇ üõ°Ô∏è DefenderC2TIManager     ‚îÇ Threat Intelligence (Indicators)            ‚îÇ\n‚îÇ üö® DefenderC2IncidentManager‚îÇ Incident Management (Update, Comment)      ‚îÇ\n‚îÇ ‚öôÔ∏è DefenderC2CDManager     ‚îÇ Custom Detection Rules                      ‚îÇ\n‚îÇ üéª DefenderC2Orchestrator  ‚îÇ Live Response & Library Operations          ‚îÇ\n‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ\n```\n\n</div>\n\n### üìã Step-by-Step Execution\n\nExecute commands and track results through the following workflow:\n\n---"
            },
            "name": "text - console-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "refresh-interval-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "RefreshInterval",
                  "label": "Auto Refresh Interval",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"10000\",\"label\":\"üü¢ 10 seconds\"},{\"value\":\"30000\",\"label\":\"üü¢ 30 seconds\"},{\"value\":\"60000\",\"label\":\"üü° 1 minute\"},{\"value\":\"300000\",\"label\":\"üîµ 5 minutes\"},{\"value\":\"0\",\"label\":\"üî¥ Manual Only\"}]",
                  "defaultValue": "30000",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "command-type-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "CommandType",
                  "label": "Command Type",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"dispatcher\", \"label\": \"\\ud83c\\udfaf Device Actions (Isolate, Scan, etc.)\"}, {\"value\": \"hunt\", \"label\": \"\\ud83d\\udd0d Advanced Hunting Query\"}, {\"value\": \"ti\", \"label\": \"\\ud83d\\udccd Threat Intelligence\"}, {\"value\": \"incident\", \"label\": \"\\ud83d\\udea8 Incident Management\"}, {\"value\": \"detection\", \"label\": \"\\ud83d\\udee1\\ufe0f Custom Detection\"}, \"\\ud83d\\udcda List Library Files\", \"\\ud83d\\udce4 Upload to Library\", \"\\ud83d\\udce5 Get Library File\", \"\\ud83d\\ude80 Deploy from Library\"]",
                  "defaultValue": "dispatcher",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "description": "Select command type: Device actions, Live Response commands, or Library management"
                },
                {
                  "id": "action-name-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "ActionName",
                  "label": "Action/Command",
                  "type": 2,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\"isolate\",\"label\":\"Isolate Device\"},{\"value\":\"unisolate\",\"label\":\"Unisolate Device\"},{\"value\":\"scan\",\"label\":\"Run Antivirus Scan\"},{\"value\":\"collect\",\"label\":\"Collect Investigation Package\"},{\"value\":\"restrict\",\"label\":\"Restrict App Execution\"},{\"value\":\"unrestrict\",\"label\":\"Unrestrict App Execution\"},{\"value\":\"stopandquarantine\",\"label\":\"Stop & Quarantine File\"},{\"value\":\"runscript\",\"label\":\"Run Live Response Script\"},{\"value\":\"getfile\",\"label\":\"Get File (Live Response)\"},{\"value\":\"putfile\",\"label\":\"Put File (Live Response)\"}]",
                  "defaultValue": "isolate",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "device-ids-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "DeviceIds",
                  "label": "Target Device IDs (comma-separated)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Enter one or more device IDs separated by commas",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "isGlobal": true
                },
                {
                  "id": "command-params-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "CommandParams",
                  "label": "Additional Parameters (JSON)",
                  "type": 1,
                  "isRequired": false,
                  "description": "Optional JSON parameters for the command",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "action-id-console",
                  "version": "KqlParameterItem/1.0",
                  "name": "ActionId",
                  "label": "Action ID (for polling)",
                  "type": 1,
                  "isRequired": false,
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "library-filename-upload",
                  "version": "KqlParameterItem/1.0",
                  "name": "LibraryFileNameUpload",
                  "label": "üì§ Library File Name (Upload)",
                  "type": 1,
                  "description": "Name for the file in library (e.g., investigation.ps1)",
                  "typeSettings": {
                    "multiLineText": false
                  },
                  "conditionalVisibility": {
                    "parameterName": "CommandType",
                    "comparison": "isEqualTo",
                    "value": "üì§ Upload to Library"
                  },
                  "isGlobal": true
                },
                {
                  "id": "library-content-upload",
                  "version": "KqlParameterItem/1.0",
                  "name": "LibraryContentUpload",
                  "label": "üì§ File Content (Base64 encoded)",
                  "type": 1,
                  "description": "Base64-encoded file content to upload to library",
                  "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "text"
                  },
                  "conditionalVisibility": {
                    "parameterName": "CommandType",
                    "comparison": "isEqualTo",
                    "value": "üì§ Upload to Library"
                  },
                  "isGlobal": true
                },
                {
                  "id": "library-filename-get",
                  "version": "KqlParameterItem/1.0",
                  "name": "LibraryFileNameGet",
                  "label": "üì• Library File Name (Get)",
                  "type": 1,
                  "description": "Name of file to retrieve from library",
                  "typeSettings": {
                    "multiLineText": false
                  },
                  "conditionalVisibility": {
                    "parameterName": "CommandType",
                    "comparison": "isEqualTo",
                    "value": "üì• Get Library File"
                  }
                },
                {
                  "id": "library-deploy-filename",
                  "version": "KqlParameterItem/1.0",
                  "name": "LibraryDeployFileName",
                  "label": "üöÄ Library File Name (Deploy)",
                  "type": 1,
                  "description": "Name of file from library to deploy to device(s)",
                  "typeSettings": {
                    "multiLineText": false
                  },
                  "conditionalVisibility": {
                    "parameterName": "CommandType",
                    "comparison": "isEqualTo",
                    "value": "üöÄ Deploy from Library"
                  },
                  "isGlobal": true
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - console-config"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üöÄ Step 1: Execute Command\n\nClick the button below to execute the selected command. The Function App will process the request asynchronously."
            },
            "name": "text - step1-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$\",\"columns\":[{\"path\":\"$.action\",\"columnid\":\"Action\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.message\",\"columnid\":\"Message\"},{\"path\":\"$.timestamp\",\"columnid\":\"Timestamp\"},{\"path\":\"$.details\",\"columnid\":\"Details\"},{\"path\":\"$.actionIds\",\"columnid\":\"Action IDs\"}]}}],\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"action\",\"value\":\"{CommandType}\"},{\"key\":\"actionName\",\"value\":\"{ActionName}\"},{\"key\":\"deviceIds\",\"value\":\"{DeviceIds}\"},{\"key\":\"params\",\"value\":\"{CommandParams}\"}]}",
              "size": 4,
              "title": "üéØ Command Execution Status",
              "noDataMessage": "Click 'Run Query' to execute command",
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - execute-command"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### ‚è≥ Step 2: Poll for Results\n\nAutomatically polls for command completion. Refresh interval: **{RefreshInterval}ms**"
            },
            "name": "text - step2-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$\",\"columns\":[{\"path\":\"$.action\",\"columnid\":\"Action\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.message\",\"columnid\":\"Message\"},{\"path\":\"$.details\",\"columnid\":\"Details\"},{\"path\":\"$.actionStatus.status\",\"columnid\":\"Action Status\"},{\"path\":\"$.actionStatus.type\",\"columnid\":\"Type\"}]}}],\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"action\",\"value\":\"getstatus\"},{\"key\":\"actionId\",\"value\":\"{ActionId}\"}]}",
              "size": 0,
              "title": "üìä Action Status (Auto-refresh)",
              "noDataMessage": "No active actions to poll. Execute a command first.",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "‚úÖ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "orange",
                          "text": "‚è≥ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "yellow",
                          "text": "‚è∏Ô∏è {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "‚ùå {0}"
                        }
                      ]
                    }
                  }
                ]
              },
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - poll-status"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üì• Step 3: View Results\n\nParsed JSON results from the command execution."
            },
            "name": "text - step3-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$\",\"columns\":[{\"path\":\"$.action\",\"columnid\":\"Action\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.message\",\"columnid\":\"Message\"},{\"path\":\"$.details\",\"columnid\":\"Details\"},{\"path\":\"$.results\",\"columnid\":\"Results\"}]}}],\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"action\",\"value\":\"getresults\"},{\"key\":\"actionId\",\"value\":\"{ActionId}\"}]}",
              "size": 0,
              "title": "üìã Command Results",
              "noDataMessage": "No results available yet. Command may still be executing.",
              "exportToExcelOptions": "all",
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "query - results"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üìö Command History\n\nRecent command executions and their status."
            },
            "name": "text - history-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.history[*]\",\"columns\":[{\"path\":\"$.action\",\"columnid\":\"Action\"},{\"path\":\"$.status\",\"columnid\":\"Status\"},{\"path\":\"$.timestamp\",\"columnid\":\"Timestamp\"},{\"path\":\"$.message\",\"columnid\":\"Message\"},{\"path\":\"$.details\",\"columnid\":\"Details\"}]}}],\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"action\",\"value\":\"history\"},{\"key\":\"limit\",\"value\":\"20\"}]}",
              "size": 4,
              "title": "üìä Execution History (Last 20)",
              "noDataMessage": "No command history available.",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "‚úÖ {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "‚ùå {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "timestamp",
                    "formatter": 6
                  }
                ]
              },
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "name": "query - history"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n### üîÑ How It Works\n\n**Architecture:**\n1. **Execute** ‚Üí Sends command to Function App with parameters\n2. **Function App** ‚Üí Authenticates with MDE API using managed identity\n3. **Poll** ‚Üí Automatically checks action status at configured interval\n4. **Parse** ‚Üí Extracts and displays JSON results in table format\n5. **History** ‚Üí Tracks all executions for audit and review\n\n**Key Features:**\n- ‚úÖ Async execution - commands run in background\n- ‚úÖ Auto-polling - no manual status checking needed\n- ‚úÖ JSON parsing - structured data display\n- ‚úÖ Multi-tenant - works across different tenants\n- ‚úÖ Audit trail - complete execution history\n\n**Supported Commands:**\n- Device actions (isolate, scan, collect packages)\n- Live Response operations (run scripts, get/put files)\n- Advanced Hunting queries\n- Threat Intelligence management\n- Incident and detection operations\n\n---\n\n> üí° **Tip:** Set auto-refresh to 30 seconds for active monitoring, or disable for manual control."
            },
            "name": "text - console-footer"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Orchestrator\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.files[*]\",\"columns\":[{\"path\":\"$.fileName\",\"columnid\":\"File Name\"},{\"path\":\"$.size\",\"columnid\":\"Size (bytes)\"},{\"path\":\"$.lastModified\",\"columnid\":\"Last Modified\"},{\"path\":\"$.contentType\",\"columnid\":\"Content Type\"}]}}],\"urlParams\":[{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"action\",\"value\":\"ListLibraryFiles\"}]}",
              "size": 0,
              "title": "üìö Library Files",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isEqualTo",
              "value": "console"
            },
            "name": "query - library-list"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "library-upload-action",
                  "cellValue": "libraryUploadResult",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üì§ Upload File to Library",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Orchestrator/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "fileName",
                        "value": "{LibraryFileNameUpload}"
                      },
                      {
                        "key": "fileContent",
                        "value": "{LibraryContentUpload}"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "action",
                        "value": "UploadToLibrary"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Upload to Library",
                    "description": "Uploading {LibraryFileNameUpload} to library",
                    "actionName": "Upload",
                    "runLabel": "Upload"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{LibraryFileNameUpload}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{LibraryContentUpload}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "CommandType",
              "comparison": "isEqualTo",
              "value": "üì§ Upload to Library"
            },
            "name": "library-upload-action"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"POST\",\"url\":\"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Orchestrator\",\"body\":null,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$\",\"columns\":[{\"path\":\"$.fileName\",\"columnid\":\"File Name\"},{\"path\":\"$.size\",\"columnid\":\"Size (bytes)\"},{\"path\":\"$.contentType\",\"columnid\":\"Content Type\"},{\"path\":\"$.lastModified\",\"columnid\":\"Last Modified\"},{\"path\":\"$.content\",\"columnid\":\"Content (Text)\"},{\"path\":\"$.contentBase64\",\"columnid\":\"Content (Base64)\"}]}}],\"urlParams\":[{\"key\":\"fileName\",\"value\":\"{LibraryFileNameGet}\"},{\"key\":\"tenantId\",\"value\":\"{TenantId}\"},{\"key\":\"action\",\"value\":\"GetLibraryFile\"}]}",
              "size": 0,
              "title": "üì• Library File Content",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 10,
              "visualization": "table",
              "criteriaData": [
                {
                  "criterionType": "param",
                  "value": "{FunctionAppName}"
                },
                {
                  "criterionType": "param",
                  "value": "{TenantId}"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "CommandType",
              "comparison": "isEqualTo",
              "value": "üì• Get Library File"
            },
            "name": "library-get-query"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "library-deploy-action",
                  "cellValue": "libraryDeployResult",
                  "linkTarget": "ArmAction",
                  "linkLabel": "üöÄ Deploy Library File to Device(s)",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "PutFile"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceIds}"
                      },
                      {
                        "key": "fileName",
                        "value": "{LibraryDeployFileName}"
                      },
                      {
                        "key": "libraryFile",
                        "value": true
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      }
                    ],
                    "body": null,
                    "httpMethod": "POST",
                    "title": "Deploy from Library",
                    "description": "Deploying {LibraryDeployFileName} from library to {DeviceIds}",
                    "actionName": "Deploy",
                    "runLabel": "Deploy"
                  },
                  "criteriaData": [
                    {
                      "criterionType": "param",
                      "value": "{Subscription}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{ResourceGroup}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{FunctionAppName}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{TenantId}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{DeviceIds}"
                    },
                    {
                      "criterionType": "param",
                      "value": "{LibraryDeployFileName}"
                    }
                  ]
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "CommandType",
              "comparison": "isEqualTo",
              "value": "üöÄ Deploy from Library"
            },
            "name": "library-deploy-action"
          }
        ]
      },
      "name": "group - console"
    }
  ],
  "defaultResourceIds": [
    "/subscriptions/PLACEHOLDER"
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}