{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "<style>\n/* DefenderC2 Retro Terminal Theme - Matrix/Green Phosphor CRT Style */\n.workbook-content {\n    background-color: #000000 !important;\n    font-family: 'Courier New', 'Consolas', monospace !important;\n    color: #00ff00 !important;\n}\n\n/* Headers and titles */\n.workbook-content h1, \n.workbook-content h2, \n.workbook-content h3 {\n    color: #00ff00 !important;\n    text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n    border-bottom: 2px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Parameter panels and inputs */\n.workbook-content .parameter-container {\n    background-color: #001100 !important;\n    border: 1px solid #00ff00 !important;\n    padding: 10px !important;\n}\n\n.workbook-content input, \n.workbook-content select, \n.workbook-content textarea {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Tables */\n.workbook-content table {\n    background-color: #000000 !important;\n    border: 1px solid #00ff00 !important;\n}\n\n.workbook-content th {\n    background-color: #001a00 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n}\n\n.workbook-content td {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #003300 !important;\n}\n\n.workbook-content tr:hover td {\n    background-color: #001100 !important;\n}\n\n/* Buttons and links */\n.workbook-content button, \n.workbook-content .link-item {\n    background-color: #001100 !important;\n    color: #00ff00 !important;\n    border: 2px solid #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n    font-family: 'Courier New', monospace !important;\n    padding: 8px 16px !important;\n    transition: all 0.2s !important;\n}\n\n.workbook-content button:hover, \n.workbook-content .link-item:hover {\n    background-color: #00ff00 !important;\n    color: #000000 !important;\n    box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;\n}\n\n/* Tabs */\n.workbook-content .tab-item {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n}\n\n.workbook-content .tab-item.active {\n    background-color: #001a00 !important;\n    box-shadow: 0 0 10px #00ff00;\n}\n\n/* Code blocks and console */\n.workbook-content pre, \n.workbook-content code {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 1px solid #00ff00 !important;\n    font-family: 'Courier New', monospace !important;\n}\n\n/* Interactive console specific styling */\n.workbook-content .console-output {\n    background-color: #000000 !important;\n    color: #00ff00 !important;\n    border: 2px solid #00ff00 !important;\n    padding: 10px !important;\n    font-family: 'Courier New', monospace !important;\n    min-height: 400px !important;\n    box-shadow: inset 0 0 20px #001100;\n}\n\n/* CRT scanline effect */\n.workbook-content::before {\n    content: \" \";\n    display: block;\n    position: fixed;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));\n    z-index: 2;\n    background-size: 100% 2px, 3px 100%;\n    pointer-events: none;\n}\n\n/* Terminal prompt cursor */\n.workbook-content .console-prompt::after {\n    content: \"\u258b\";\n    animation: blink 1s infinite;\n    color: #00ff00;\n}\n\n@keyframes blink {\n    0%, 49% { opacity: 1; }\n    50%, 100% { opacity: 0; }\n}\n\n/* Success indicators */\n.workbook-content .status-success {\n    color: #00ff00 !important;\n    text-shadow: 0 0 5px #00ff00;\n}\n\n/* Warning indicators */\n.workbook-content .status-warning {\n    color: #ffff00 !important;\n    text-shadow: 0 0 5px #ffff00;\n}\n\n/* Error indicators */\n.workbook-content .status-error {\n    color: #ff0000 !important;\n    text-shadow: 0 0 5px #ff0000;\n}\n\n/* Glow effect for important elements */\n.workbook-content .highlight {\n    box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00;\n}\n</style>\n\n# \ud83d\udda5\ufe0f DefenderC2 Command & Control Console\n\n> **Enterprise-grade automation and orchestration for Microsoft Defender for Endpoint**  \n> *Port of @msdirtbag/MDEAutomator with retro terminal aesthetic*\n\n---\n\n## \ud83c\udfa8 Retro Terminal Theme\n\nThis workbook features a **retro green phosphor CRT terminal theme** inspired by classic command-line interfaces.\n\n## \u26a1 Quick Start Configuration\n\nSelect your **DefenderC2 Function App** and **Workspace** - everything else autodiscovers!\n\n### What's Autodiscovered:\n- \u2705 **Subscription ID** (from Function App resource)\n- \u2705 **Resource Group** (from Function App resource)  \n- \u2705 **Function App Name** (from Function App resource)\n- \u2705 **Azure AD Tenant ID** (from Function App resource - this is where your App Registration lives!)\n- \u2705 **API Authentication** (anonymous function endpoint - no key required)\n\n### You Only Select:\n1. \ud83c\udfaf Your DefenderC2 Function App (one click)\n2. \ud83d\udcca Your Log Analytics Workspace (one click)\n\n---\n\n## \ud83d\udccb Tabs Overview\n\n| Tab | Function | Description |\n|-----|----------|-------------|\n| **\ud83c\udfaf Defender C2** | Device Actions | Isolate, scan, restrict devices |\n| **\ud83d\udee1\ufe0f Threat Intel Manager** | Indicators | Manage file/network/certificate indicators |\n| **\ud83d\udccb Action Manager** | Action Tracking | View and manage device actions |\n| **\ud83d\udd0d Hunt Manager** | Advanced Hunting | Execute KQL hunting queries |\n| **\ud83d\udea8 Incident Manager** | Incident Response | Manage security incidents |\n| **\u2699\ufe0f Custom Detection Manager** | Detection Rules | Manage custom detection rules |\n| **\ud83d\udda5\ufe0f Interactive Console** | Live Response | Shell-like command interface with async execution |\n\n---"
      },
      "name": "text - header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "fa",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionApp",
            "label": "DefenderC2 Function App",
            "type": 5,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where type == 'microsoft.web/sites' and kind == 'functionapp' | project id, name, resourceGroup, subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false,
              "resourceTypeFilter": {
                "microsoft.web/sites": true
              }
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "sub",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "rg",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = resourceGroup",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "fn",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionAppName",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = name",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "tid",
            "version": "KqlParameterItem/1.0",
            "name": "TenantId",
            "label": "Defender XDR Tenant",
            "type": 2,
            "isRequired": true,
            "isGlobal": true,
            "query": "ResourceContainers | where type == 'microsoft.resources/subscriptions' | project tenantId | distinct tenantId | project value = tenantId, label = strcat('Tenant: ', tenantId)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "selectFirstItem": true,
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "dev",
            "version": "KqlParameterItem/1.0",
            "name": "DeviceList",
            "label": "\ud83d\udda5\ufe0f Selected Devices",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Click devices below to select (auto-filters results)"
          },
          {
            "id": "fh",
            "version": "KqlParameterItem/1.0",
            "name": "FileHash",
            "label": "\ud83e\udda0 File Hash (SHA1)",
            "type": 1,
            "isGlobal": true,
            "value": ""
          },
          {
            "id": "aid",
            "version": "KqlParameterItem/1.0",
            "name": "ActionIdToCancel",
            "label": "\ud83d\uddd1\ufe0f Action ID",
            "type": 1,
            "isGlobal": true,
            "value": ""
          },
          {
            "id": "ref",
            "version": "KqlParameterItem/1.0",
            "name": "AutoRefresh",
            "label": "\ud83d\udd04 Auto Refresh",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"0\", \"label\": \"Off\"}, {\"value\": \"30000\", \"label\": \"Every 30 seconds\"}, {\"value\": \"60000\", \"label\": \"Every 1 minute\"}]",
            "value": "30000"
          },
          {
            "id": "script-name-param",
            "version": "KqlParameterItem/1.0",
            "name": "ScriptName",
            "label": "\ud83d\udcdc Selected Script",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Click scripts in Library Files to select"
          },
          {
            "id": "file-path-download",
            "version": "KqlParameterItem/1.0",
            "name": "FilePathToDownload",
            "label": "\ud83d\udcc2 File Path",
            "type": 1,
            "isGlobal": true,
            "value": "C:\\\\Temp\\\\file.txt",
            "description": "Path to file on device"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "tab-devices",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83c\udfaf Device Manager",
            "subTarget": "devices",
            "style": "link"
          },
          {
            "id": "tab-ti",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udee1\ufe0f Threat Intel",
            "subTarget": "threatintel",
            "style": "link"
          },
          {
            "id": "tab-actions",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udccb Action Manager",
            "subTarget": "actions",
            "style": "link"
          },
          {
            "id": "tab-hunt",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udd0d Hunt Manager",
            "subTarget": "hunting",
            "style": "link"
          },
          {
            "id": "tab-incidents",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udea8 Incidents",
            "subTarget": "incidents",
            "style": "link"
          },
          {
            "id": "tab-detections",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\u2699\ufe0f Custom Detections",
            "subTarget": "detections",
            "style": "link"
          },
          {
            "id": "tab-console",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "\ud83d\udda5\ufe0f Live Response Console",
            "subTarget": "console",
            "style": "link"
          }
        ]
      },
      "name": "tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83c\udfaf Device Management & Response Actions",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \ud83d\udcbb STEP 1: Device Inventory\\n\\n**Click '\u2705 Select' to add devices** | **Selected:** {DeviceList}"
            },
            "name": "inv-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get Devices\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.devices[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"ComputerName\"}, {\"path\": \"$.osPlatform\", \"columnid\": \"OS\"}, {\"path\": \"$.healthStatus\", \"columnid\": \"Health\"}, {\"path\": \"$.riskScore\", \"columnid\": \"Risk\"}, {\"path\": \"$.exposureLevel\", \"columnid\": \"Exposure\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udda5\ufe0f All Devices",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DeviceID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u2705 Select",
                      "parameterName": "DeviceList",
                      "parameterValue": "{DeviceList},{0}"
                    }
                  },
                  {
                    "columnMatch": "Health",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Active",
                          "representation": "success",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Risk",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redGreen"
                    }
                  },
                  {
                    "columnMatch": "Exposure",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "\ud83d\udd34 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "\ud83d\udfe0 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "green",
                          "text": "\ud83d\udfe2 {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "ComputerName",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "ComputerName",
                  "sortOrder": 1
                }
              ]
            },
            "name": "inventory"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \u26a0\ufe0f STEP 2: Conflict Detection\\n\\n**\ud83c\udfaf Smart Filter:** Showing only actions for selected devices\\n\\n**Selected Devices:** {DeviceList}"
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "conflict-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.type\", \"columnid\": \"RunningAction\"}, {\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f Running Actions on Selected Devices",
              "noDataMessage": "\u2705 NO CONFLICTS - Safe to execute",
              "noDataMessageStyle": 3,
              "showRefreshButton": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "RunningAction",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "representation": "orange",
                          "text": "\u26a0\ufe0f {0} - Check before executing same action"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ActionID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "ActionIdToCancel",
                      "parameterValue": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "2",
                          "text": "\u2699\ufe0f {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "filterSettings": {
                  "defaultFilters": [
                    {
                      "columnId": "DeviceID",
                      "operator": "in",
                      "value": "{DeviceList}"
                    }
                  ]
                }
              }
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "conflict-check"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \u26a1 STEP 3: Execute ARM Actions\\n\\n**Selected Devices:** {DeviceList}\\n\\n**Azure will show confirmation dialog before execution.**"
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "arm-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "arm-scan",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd0d Run Antivirus Scan",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Run Antivirus Scan"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Run Antivirus Scan via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Run Antivirus Scan",
                    "description": "Run Antivirus Scan initiated successfully",
                    "actionName": "Run Antivirus Scan",
                    "runLabel": "Execute Run Antivirus Scan",
                    "successMessage": "\u2705 Run Antivirus Scan command sent successfully!"
                  }
                },
                {
                  "id": "arm-isolate",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd12 Isolate Device (DESTRUCTIVE)",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Isolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Isolate Device via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Isolate Device",
                    "description": "Isolate Device initiated successfully",
                    "actionName": "Isolate Device",
                    "runLabel": "Execute Isolate Device",
                    "successMessage": "\u2705 Isolate Device command sent successfully!"
                  }
                },
                {
                  "id": "arm-unisolate",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd13 Unisolate Device",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Unisolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Unisolate Device via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Unisolate Device",
                    "description": "Unisolate Device initiated successfully",
                    "actionName": "Unisolate Device",
                    "runLabel": "Execute Unisolate Device",
                    "successMessage": "\u2705 Unisolate Device command sent successfully!"
                  }
                },
                {
                  "id": "arm-collect",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udce6 Collect Investigation Package",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Collect Investigation Package"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Collect Investigation Package via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Collect Investigation Package",
                    "description": "Collect Investigation Package initiated successfully",
                    "actionName": "Collect Investigation Package",
                    "runLabel": "Execute Collect Investigation Package",
                    "successMessage": "\u2705 Collect Investigation Package command sent successfully!"
                  }
                },
                {
                  "id": "arm-restrict",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udeab Restrict App Execution (DESTRUCTIVE)",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Restrict App Execution"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Restrict App Execution via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Restrict App Execution",
                    "description": "Restrict App Execution initiated successfully",
                    "actionName": "Restrict App Execution",
                    "runLabel": "Execute Restrict App Execution",
                    "successMessage": "\u2705 Restrict App Execution command sent successfully!"
                  }
                },
                {
                  "id": "arm-unrestrict",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u2705 Unrestrict App Execution",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Unrestrict App Execution"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "Unrestrict App Execution via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Unrestrict App Execution",
                    "description": "Unrestrict App Execution initiated successfully",
                    "actionName": "Unrestrict App Execution",
                    "runLabel": "Execute Unrestrict App Execution",
                    "successMessage": "\u2705 Unrestrict App Execution command sent successfully!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "arm-device-actions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \ud83e\udda0 File Quarantine\\n\\n**File Hash:** {FileHash}"
            },
            "conditionalVisibility": {
              "parameterName": "FileHash",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "file-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "arm-quarantine",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83e\udda0 Stop & Quarantine File (DESTRUCTIVE)",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Stop & Quarantine File"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "fileHash",
                        "value": "{FileHash}"
                      },
                      {
                        "key": "comment",
                        "value": "Quarantined via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Stop & Quarantine File",
                    "description": "File quarantine initiated successfully",
                    "actionName": "Stop & Quarantine File",
                    "runLabel": "Execute Quarantine",
                    "successMessage": "\u2705 File quarantine command sent successfully!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "FileHash",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "arm-file-action"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \ud83d\udcca STEP 4: Status Tracking\\n\\n**\ud83c\udfaf Smart Filter:** {DeviceList:nonempty:Showing all actions|Showing only actions for selected devices}"
            },
            "name": "status-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.type\", \"columnid\": \"Action\"}, {\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.creationDateTimeUtc\", \"columnid\": \"Started\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f Machine Actions",
              "showRefreshButton": true,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ActionID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "ActionIdToCancel",
                      "parameterValue": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "2",
                          "text": "\u2699\ufe0f {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "success",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "failed",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Cancelled",
                          "representation": "cancelled",
                          "text": "\ud83d\udeab {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "filterSettings": {
                  "defaultFilters": [
                    {
                      "columnId": "DeviceID",
                      "operator": "in",
                      "value": "{DeviceList}"
                    }
                  ]
                },
                "sortBy": [
                  {
                    "itemKey": "Started",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Started",
                  "sortOrder": 2
                }
              ]
            },
            "name": "all-actions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\\n\\n## \u274c STEP 5: Cancel Action\\n\\n**Action ID:** {ActionIdToCancel}"
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "arm-cancel",
                  "cellValue": "unused",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u274c Cancel Action",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Cancel Action"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "actionId",
                        "value": "{ActionIdToCancel}"
                      },
                      {
                        "key": "comment",
                        "value": "Cancelled via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "\u2705 Cancel Action",
                    "description": "Action cancelled successfully",
                    "actionName": "Cancel Action",
                    "runLabel": "Cancel",
                    "successMessage": "\u2705 Action cancellation command sent successfully!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "devices"
      },
      "name": "group - devices"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udee1\ufe0f Threat Intelligence Management",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udee1\ufe0f Threat Intelligence Manager\n\nManage file, IP, URL/Domain indicators for Microsoft Defender."
            },
            "name": "ti-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2TIManager\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"List All Indicators\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.indicators[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"ID\"}, {\"path\": \"$.indicatorValue\", \"columnid\": \"Indicator\"}, {\"path\": \"$.indicatorType\", \"columnid\": \"Type\"}, {\"path\": \"$.action\", \"columnid\": \"Action\"}, {\"path\": \"$.severity\", \"columnid\": \"Severity\"}, {\"path\": \"$.title\", \"columnid\": \"Title\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udccb All Threat Indicators",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "filter": true
              }
            },
            "name": "ti-list"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \ud83d\udcc4 File Indicators (SHA256)\n\nAdd or remove file hash indicators."
            },
            "name": "ti-file-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "file-hashes",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileHashes",
                  "label": "File Hashes (SHA256, comma-separated)",
                  "type": 1,
                  "value": ""
                },
                {
                  "id": "file-action",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileAction",
                  "label": "Action",
                  "type": 2,
                  "jsonData": "[\"Alert\", \"Block\", \"Allow\"]",
                  "value": "Alert"
                },
                {
                  "id": "file-severity",
                  "version": "KqlParameterItem/1.0",
                  "name": "FileSeverity",
                  "label": "Severity",
                  "type": 2,
                  "jsonData": "[\"Low\", \"Medium\", \"High\"]",
                  "value": "Medium"
                }
              ],
              "style": "pills"
            },
            "name": "ti-file-params"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "ti-add-file",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u2795 Add File Indicators",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2TIManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add File Indicators"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "indicators",
                        "value": "{FileHashes}"
                      },
                      {
                        "key": "recommendedAction",
                        "value": "{FileAction}"
                      },
                      {
                        "key": "severity",
                        "value": "{FileSeverity}"
                      },
                      {
                        "key": "title",
                        "value": "Indicator added via DefenderC2"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Add File Indicators",
                    "description": "Adding file indicators...",
                    "runLabel": "Add Indicators"
                  }
                }
              ]
            },
            "name": "ti-file-actions"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "ti-add-url",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u2795 Add URL/Domain Indicators",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2TIManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add URL/Domain Indicators"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "indicators",
                        "value": "{URLs}"
                      },
                      {
                        "key": "recommendedAction",
                        "value": "{URLAction}"
                      },
                      {
                        "key": "severity",
                        "value": "{URLSeverity}"
                      },
                      {
                        "key": "title",
                        "value": "URL/Domain Indicator added via DefenderC2"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Add URL/Domain Indicators",
                    "description": "Adding URL/Domain indicators...",
                    "runLabel": "Add Indicators"
                  }
                }
              ]
            },
            "name": "ti-url-actions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \ud83c\udf10 IP Address Indicators\n\nAdd or remove IP address indicators (IPv4/IPv6)."
            },
            "name": "ti-ip-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "ip-addresses",
                  "version": "KqlParameterItem/1.0",
                  "name": "IPAddresses",
                  "label": "IP Addresses (comma-separated)",
                  "type": 1,
                  "value": ""
                },
                {
                  "id": "ip-action",
                  "version": "KqlParameterItem/1.0",
                  "name": "IPAction",
                  "label": "Action",
                  "type": 2,
                  "jsonData": "[\"Alert\", \"Block\", \"Allow\"]",
                  "value": "Alert"
                },
                {
                  "id": "ip-severity",
                  "version": "KqlParameterItem/1.0",
                  "name": "IPSeverity",
                  "label": "Severity",
                  "type": 2,
                  "jsonData": "[\"Low\", \"Medium\", \"High\"]",
                  "value": "Medium"
                }
              ],
              "style": "pills"
            },
            "name": "ti-ip-params"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "ti-add-ip",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u2795 Add IP Indicators",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2TIManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Add IP Indicators"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "indicators",
                        "value": "{IPAddresses}"
                      },
                      {
                        "key": "recommendedAction",
                        "value": "{IPAction}"
                      },
                      {
                        "key": "severity",
                        "value": "{IPSeverity}"
                      },
                      {
                        "key": "title",
                        "value": "IP Indicator added via DefenderC2"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Add IP Indicators",
                    "description": "Adding IP indicators...",
                    "runLabel": "Add Indicators"
                  }
                }
              ]
            },
            "name": "ti-ip-actions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \ud83c\udf0d URL/Domain Indicators\n\nAdd or remove URL and domain indicators."
            },
            "name": "ti-url-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "urls",
                  "version": "KqlParameterItem/1.0",
                  "name": "URLs",
                  "label": "URLs/Domains (comma-separated)",
                  "type": 1,
                  "value": ""
                },
                {
                  "id": "url-action",
                  "version": "KqlParameterItem/1.0",
                  "name": "URLAction",
                  "label": "Action",
                  "type": 2,
                  "jsonData": "[\"Alert\", \"Block\", \"Allow\"]",
                  "value": "Alert"
                },
                {
                  "id": "url-severity",
                  "version": "KqlParameterItem/1.0",
                  "name": "URLSeverity",
                  "label": "Severity",
                  "type": 2,
                  "jsonData": "[\"Low\", \"Medium\", \"High\"]",
                  "value": "Medium"
                }
              ],
              "style": "pills"
            },
            "name": "ti-url-params"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "threatintel"
      },
      "name": "group - threatintel"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udccb Action Management & Monitoring",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udccb Action Manager\n\nView and manage all device actions across your environment."
            },
            "name": "action-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.type\", \"columnid\": \"Action\"}, {\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.creationDateTimeUtc\", \"columnid\": \"Created\"}, {\"path\": \"$.lastUpdateDateTimeUtc\", \"columnid\": \"Updated\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f All Device Actions",
              "showRefreshButton": true,
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ActionID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "ActionIdToCancel",
                      "parameterValue": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "green",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "blue",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "red",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "Default",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "action-list"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n### \u274c Cancel Action\n\n**Action ID to Cancel:** `{ActionIdToCancel}`"
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "cancel-action",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u274c Cancel Action",
                  "style": "secondary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "action",
                        "value": "Cancel Action"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "actionId",
                        "value": "{ActionIdToCancel}"
                      },
                      {
                        "key": "comment",
                        "value": "Cancelled via DefenderC2 Workbook"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Cancel Action",
                    "description": "Cancelling action...",
                    "runLabel": "Cancel"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ActionIdToCancel",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-action-button"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "actions"
      },
      "name": "group - actions"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udd0d Advanced Hunting",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udd0d Advanced Hunting Manager\n\n**Execute KQL queries against Microsoft Defender XDR Advanced Hunting**\n\n### Console-like Query Interface\n\nSimulates the Defender XDR Advanced Hunting experience with:\n- \ud83d\udcdd Multi-line query editor\n- \ud83c\udfaf Quick-start example queries\n- \ud83d\udcca Real-time results\n- \ud83d\udcbe Query history (via parameters)\n\n---"
            },
            "name": "hunt-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "hunt-query",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntQuery",
                  "label": "\ud83c\udfaf KQL Query",
                  "type": 1,
                  "multiLine": true,
                  "description": "Enter your KQL query here (Kusto Query Language)",
                  "value": "DeviceInfo\\n| where Timestamp > ago(7d)\\n| summarize DeviceCount = dcount(DeviceId) by OsPlatform\\n| order by DeviceCount desc",
                  "isGlobal": true
                },
                {
                  "id": "hunt-name",
                  "version": "KqlParameterItem/1.0",
                  "name": "HuntName",
                  "label": "\ud83d\udccb Hunt Name",
                  "type": 1,
                  "description": "Give your hunt a descriptive name",
                  "value": "Device Inventory by OS",
                  "isGlobal": true
                }
              ],
              "style": "pills"
            },
            "name": "hunt-params"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "execute-hunt",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd0d Execute Hunt Query",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2HuntManager/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "huntQuery",
                        "value": "{HuntQuery}"
                      },
                      {
                        "key": "huntName",
                        "value": "{HuntName}"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Execute Advanced Hunt",
                    "description": "Executing advanced hunting query against Defender XDR...",
                    "actionName": "Execute Hunt",
                    "runLabel": "\u25b6\ufe0f Run Query",
                    "successMessage": "\u2705 Hunt query executed! Check response for results."
                  }
                }
              ]
            },
            "name": "hunt-execute"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## \ud83d\udcda Example Queries Library\n\n**Click an example to load it into the query editor above**"
            },
            "name": "examples-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "query-devices",
                  "linkTarget": "parameter",
                  "linkLabel": "\ud83d\udcbb Devices",
                  "parameterName": "HuntQuery",
                  "parameterValue": "DeviceInfo\\n| where Timestamp > ago(7d)\\n| summarize LastSeen = max(Timestamp) by DeviceId, DeviceName, OsPlatform\\n| order by LastSeen desc\\n| take 100",
                  "style": "link"
                },
                {
                  "id": "query-alerts",
                  "linkTarget": "parameter",
                  "linkLabel": "\ud83d\udea8 Alerts",
                  "parameterName": "HuntQuery",
                  "parameterValue": "AlertInfo\\n| where Timestamp > ago(7d)\\n| summarize AlertCount = count() by Severity, Title\\n| order by AlertCount desc\\n| take 20",
                  "style": "link"
                },
                {
                  "id": "query-logons",
                  "linkTarget": "parameter",
                  "linkLabel": "\ud83d\udd10 Logons",
                  "parameterName": "HuntQuery",
                  "parameterValue": "DeviceLogonEvents\\n| where Timestamp > ago(24h)\\n| where LogonType == 'Network'\\n| summarize LogonCount = count() by AccountName, DeviceName\\n| order by LogonCount desc\\n| take 50",
                  "style": "link"
                },
                {
                  "id": "query-processes",
                  "linkTarget": "parameter",
                  "linkLabel": "\u2699\ufe0f Processes",
                  "parameterName": "HuntQuery",
                  "parameterValue": "DeviceProcessEvents\\n| where Timestamp > ago(1h)\\n| where ProcessCommandLine has_any ('powershell', 'cmd')\\n| summarize ProcessCount = count() by FileName, InitiatingProcessFileName\\n| order by ProcessCount desc\\n| take 30",
                  "style": "link"
                },
                {
                  "id": "query-network",
                  "linkTarget": "parameter",
                  "linkLabel": "\ud83c\udf10 Network",
                  "parameterName": "HuntQuery",
                  "parameterValue": "DeviceNetworkEvents\\n| where Timestamp > ago(1h)\\n| where RemoteIPType == 'Public'\\n| summarize ConnectionCount = count() by RemoteIP, RemoteUrl\\n| order by ConnectionCount desc\\n| take 50",
                  "style": "link"
                },
                {
                  "id": "query-files",
                  "linkTarget": "parameter",
                  "linkLabel": "\ud83d\udcc1 Files",
                  "parameterName": "HuntQuery",
                  "parameterValue": "DeviceFileEvents\\n| where Timestamp > ago(24h)\\n| where ActionType in ('FileCreated', 'FileModified')\\n| summarize FileCount = count() by FolderPath, SHA256\\n| order by FileCount desc\\n| take 100",
                  "style": "link"
                },
                {
                  "id": "query-registry",
                  "linkTarget": "parameter",
                  "linkLabel": "\ud83d\uddc4\ufe0f Registry",
                  "parameterName": "HuntQuery",
                  "parameterValue": "DeviceRegistryEvents\\n| where Timestamp > ago(24h)\\n| where RegistryKey has 'Run'\\n| summarize ChangeCount = count() by RegistryKey, RegistryValueName\\n| order by ChangeCount desc\\n| take 50",
                  "style": "link"
                },
                {
                  "id": "query-threats",
                  "linkTarget": "parameter",
                  "linkLabel": "\u2620\ufe0f Threats",
                  "parameterName": "HuntQuery",
                  "parameterValue": "AlertEvidence\\n| where Timestamp > ago(7d)\\n| where ThreatFamily != ''\\n| summarize ThreatCount = count() by ThreatFamily, FileName\\n| order by ThreatCount desc\\n| take 20",
                  "style": "link"
                }
              ]
            },
            "name": "query-examples"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## \ud83d\udcd6 KQL Query Reference\n\n### Available Tables\n\n**Device Tables:**\n- `DeviceInfo` - Device inventory and properties\n- `DeviceProcessEvents` - Process execution events\n- `DeviceNetworkEvents` - Network connections\n- `DeviceFileEvents` - File operations\n- `DeviceRegistryEvents` - Registry changes\n- `DeviceLogonEvents` - Logon activities\n- `DeviceImageLoadEvents` - DLL/driver loads\n\n**Alert & Threat Tables:**\n- `AlertInfo` - Alert metadata\n- `AlertEvidence` - Evidence related to alerts\n- `ThreatIntelligenceIndicator` - Threat intel indicators\n\n**Email Tables:**\n- `EmailEvents` - Email messages\n- `EmailAttachmentInfo` - Email attachments\n- `EmailUrlInfo` - URLs in emails\n\n### Common Operators\n\n```kql\n| where Timestamp > ago(7d)        // Time filter\n| where Column == \"value\"          // Exact match\n| where Column contains \"text\"     // Partial match\n| where Column has_any (\"a\", \"b\") // Any match\n| summarize count() by Column      // Aggregation\n| order by Column desc             // Sorting\n| take 100                         // Limit results\n| extend NewCol = Column1 + Column2 // Calculated column\n| project Column1, Column2         // Select columns\n| join kind=inner Table2 on Key   // Join tables\n```\n\n### Tips\n\n1. **Performance:** Always include time filters (`ago(7d)`)\n2. **Limits:** Use `take` to limit result sets\n3. **Testing:** Start with small time windows\n4. **Aggregation:** Use `summarize` for statistics\n5. **Troubleshooting:** Check column names and data types\n\n### Documentation\n\n- [KQL Quick Reference](https://docs.microsoft.com/kusto/query/)\n- [Advanced Hunting Schema](https://docs.microsoft.com/defender-endpoint/advanced-hunting-schema-tables)\n- [Query Best Practices](https://docs.microsoft.com/defender-endpoint/advanced-hunting-best-practices)"
            },
            "name": "hunt-reference"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "hunting"
      },
      "name": "group - hunting"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udea8 Incident Management",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udea8 Incident Manager\n\nView and manage Microsoft Defender XDR incidents."
            },
            "name": "incident-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2IncidentManager\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"GetIncidents\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.incidents[*]\", \"columns\": [{\"path\": \"$.incidentId\", \"columnid\": \"ID\"}, {\"path\": \"$.incidentName\", \"columnid\": \"Name\"}, {\"path\": \"$.severity\", \"columnid\": \"Severity\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.assignedTo\", \"columnid\": \"AssignedTo\"}, {\"path\": \"$.createdDateTime\", \"columnid\": \"Created\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udea8 Recent Incidents",
              "showRefreshButton": true,
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "\ud83d\udd34 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "\ud83d\udfe0 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "\ud83d\udd35 {0}"
                        },
                        {
                          "operator": "Default",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "incident-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "incidents"
      },
      "name": "group - incidents"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\u2699\ufe0f Custom Detection Management",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \u2699\ufe0f Custom Detection Manager\n\nManage custom detection rules in Microsoft Defender."
            },
            "name": "detection-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2CDManager\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"List All Detections\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.detections[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"ID\"}, {\"path\": \"$.displayName\", \"columnid\": \"Name\"}, {\"path\": \"$.isEnabled\", \"columnid\": \"Enabled\"}, {\"path\": \"$.severity\", \"columnid\": \"Severity\"}, {\"path\": \"$.createdDateTime\", \"columnid\": \"Created\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f Custom Detection Rules",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "filter": true
              }
            },
            "name": "detection-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "detections"
      },
      "name": "group - detections"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udda5\ufe0f Live Response Console",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## \ud83d\udda5\ufe0f Live Response Console\n\n**Interactive command execution and file operations on devices**\n\n### Features:\n- \ud83c\udfaf **Native Commands** - Execute dir, cd, type, reg query, etc.\n- \ud83d\udcdc **Library Scripts** - Run PowerShell and batch scripts\n- \ud83d\udcc1 **File Operations** - Upload, download, and manage files\n- \ud83d\udcca **Session Management** - Monitor active sessions\n\n### Quick Start:\n1. **Select devices** from the Device Manager tab\n2. **Choose an operation** below\n3. **Monitor execution** in real-time\n\n---"
            },
            "name": "console-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Orchestrator\", \"body\": null, \"urlParams\": [{\"key\": \"Function\", \"value\": \"GetLiveResponseSessions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.sessions[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"SessionID\"}, {\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.createdDateTime\", \"columnid\": \"Created\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udd04 Active Live Response Sessions",
              "showRefreshButton": true,
              "timeContextFromParameter": "AutoRefresh",
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "filter": true
              }
            },
            "name": "console-sessions"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## \ud83d\udcda Live Response Library\n\n**Scripts and files available for deployment**"
            },
            "name": "library-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Orchestrator\", \"body\": null, \"urlParams\": [{\"key\": \"Function\", \"value\": \"ListLibraryFiles\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.files[*]\", \"columns\": [{\"path\": \"$.fileName\", \"columnid\": \"FileName\"}, {\"path\": \"$.fileSize\", \"columnid\": \"Size\"}, {\"path\": \"$.createdTime\", \"columnid\": \"Created\"}, {\"path\": \"$.description\", \"columnid\": \"Description\"}]}}]}",
              "size": 0,
              "title": "\ud83d\udcda Library Files & Scripts",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "FileName",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u25b6\ufe0f Select",
                      "parameterName": "ScriptName",
                      "parameterValue": "{0}"
                    }
                  },
                  {
                    "columnMatch": "Size",
                    "formatter": 3,
                    "formatOptions": {
                      "aggregation": "Sum"
                    }
                  }
                ],
                "filter": true
              }
            },
            "name": "library-files-list"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## \u25b6\ufe0f Execute Library Script\n\n**Selected Device(s):** `{DeviceList}`  \n**Selected Script:** `{ScriptName}`\n\nExecute a script from the library on selected devices."
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "execute-script-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "script-args",
                  "version": "KqlParameterItem/1.0",
                  "name": "ScriptArguments",
                  "label": "\ud83d\udcdd Script Arguments (optional)",
                  "type": 1,
                  "description": "Enter arguments for the script (space-separated)",
                  "value": ""
                }
              ],
              "style": "pills"
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "script-args-param"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "execute-script-action",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u25b6\ufe0f Execute Script on Device(s)",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Orchestrator/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "Function",
                        "value": "InvokeLiveResponseScript"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "DeviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "scriptName",
                        "value": "{ScriptName}"
                      },
                      {
                        "key": "arguments",
                        "value": "{ScriptArguments}"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Execute Live Response Script",
                    "description": "Executing script on selected device(s)...",
                    "actionName": "Execute Script",
                    "runLabel": "Execute",
                    "successMessage": "\u2705 Script execution initiated successfully!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "execute-script-button"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## \ud83d\udce4 Deploy Library File to Device\n\n**Workaround for file operations:**\n\n### Upload Workflow:\n1. **Upload files to library** via Azure Portal or PowerShell\n2. **Select a library file** from the table above\n3. **Deploy to device** using the button below\n\n**Alternative:** Use Azure Storage Explorer to manage library files directly.\n\n**Selected Device(s):** `{DeviceList}`  \n**Library File:** `{ScriptName}`"
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "deploy-file-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "deploy-file-action",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udce4 Deploy Library File to Device",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Orchestrator/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "Function",
                        "value": "PutLiveResponseFileFromLibrary"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "DeviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "fileName",
                        "value": "{ScriptName}"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Deploy Library File",
                    "description": "Deploying file from library to device...",
                    "actionName": "Deploy File",
                    "runLabel": "Deploy",
                    "successMessage": "\u2705 File deployment initiated!"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ScriptName",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "deploy-file-button"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## \ud83d\udce5 Download File from Device\n\n**Retrieve a file from a device to the library**\n\n**Selected Device(s):** `{DeviceList}`"
            },
            "name": "download-file-header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "file-path-param",
                  "version": "KqlParameterItem/1.0",
                  "name": "FilePathToDownload",
                  "label": "\ud83d\udcc2 File Path on Device",
                  "type": 1,
                  "description": "Enter full path (e.g., C:\\\\Temp\\\\suspicious.exe)",
                  "value": "C:\\\\Temp\\\\file.txt"
                }
              ],
              "style": "pills"
            },
            "name": "download-file-param"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "download-file-action",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udce5 Download File from Device",
                  "style": "primary",
                  "armActionContext": {
                    "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Orchestrator/invocations",
                    "headers": [],
                    "params": [
                      {
                        "key": "api-version",
                        "value": "2022-03-01"
                      },
                      {
                        "key": "Function",
                        "value": "GetLiveResponseFile"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "DeviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "filePath",
                        "value": "{FilePathToDownload}"
                      }
                    ],
                    "httpMethod": "POST",
                    "title": "Download File from Device",
                    "description": "Downloading file from device...",
                    "actionName": "Download File",
                    "runLabel": "Download",
                    "successMessage": "\u2705 File download initiated! Check response for download link."
                  }
                }
              ]
            },
            "name": "download-file-button"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## \ud83d\udca1 Live Response Console Tips\n\n### Native Commands\nExecute standard commands directly on devices:\n- `dir` - List directory contents\n- `cd` - Change directory\n- `type` - Display file contents\n- `reg query` - Query registry\n- `netstat` - Network statistics\n\n### Library Management\n**Upload to Library:**\n1. Use Azure Portal \u2192 Storage Account \u2192 Containers \u2192 \"library\"\n2. Or use PowerShell: `Add-AzStorageBlob -Container library -File <path>`\n3. Or use Azure Storage Explorer (GUI)\n\n**Best Practices:**\n- Test scripts locally before uploading\n- Use descriptive file names\n- Document script parameters\n- Monitor session status regularly\n\n### File Operations\n**Download:** Files are retrieved as Base64 and can be accessed via the response\n\n**Upload:** Files must be in the library first, then deployed to devices\n\n**Direct Access:** For bulk operations, use Azure Storage Explorer or PowerShell\n\n### Troubleshooting\n- Ensure devices are online and connected\n- Check Live Response is enabled in Defender settings\n- Verify adequate permissions (Security Administrator or higher)\n- Allow 30-60 seconds for session initialization\n\n---\n\n### \ud83d\udcd6 Documentation Links\n\n- [Live Response Documentation](https://docs.microsoft.com/defender-endpoint/live-response)\n- [Live Response Commands Reference](https://docs.microsoft.com/defender-endpoint/live-response-command-examples)\n- [Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/)"
            },
            "name": "console-tips"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "console"
      },
      "name": "group - console"
    }
  ],
  "fallbackResourceIds": [],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}