{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# \ud83d\udda5\ufe0f DefenderC2 Device Manager - Hybrid Version\n\n## ARM Actions + CustomEndpoint Auto-Refresh\n\n**Features:**\n- \u2705 **ARM Actions** for reliable action execution with confirmation dialogs\n- \u2705 **CustomEndpoint** for auto-refreshing status tracking\n- \u2705 **Auto-populated device selection** from Defender XDR\n- \u2705 **Pending action warnings** to prevent 400 errors\n- \u2705 **Action tracking & cancellation** via CustomEndpoint queries"
      },
      "name": "header-text"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "sub-param",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "label": "\ud83d\udd11 Subscription",
            "type": 6,
            "isRequired": true,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": false,
              "showDefault": false
            }
          },
          {
            "id": "rg-param",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "label": "\ud83d\udce6 Resource Group",
            "type": 2,
            "isRequired": true,
            "isGlobal": true,
            "query": "ResourceContainers | where type == 'microsoft.resources/resourcegroups' | where subscriptionId == '{Subscription}' | project value = id, label = name | order by label asc",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "function-app-selector",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionApp",
            "label": "\ud83d\udd27 DefenderC2 Function App",
            "type": 5,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where type == 'microsoft.web/sites' and kind == 'functionapp' | where resourceGroup == extract(@'/resourceGroups/([^/]+)', 1, '{ResourceGroup}') | project id, name, resourceGroup, subscriptionId | order by name asc",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "function-name-hidden",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionAppName",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = name",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionApp}"
              }
            ]
          },
          {
            "id": "tenant-id-selector",
            "version": "KqlParameterItem/1.0",
            "name": "TenantId",
            "label": "\ud83c\udfe2 Defender XDR Tenant",
            "type": 2,
            "isRequired": true,
            "isGlobal": true,
            "multiSelect": false,
            "query": "ResourceContainers | where type == 'microsoft.resources/subscriptions' | project tenantId | distinct tenantId | project value = tenantId, label = strcat('\ud83c\udfe2 Tenant: ', tenantId) | order by label asc",
            "crossComponentResources": [
              "value::all"
            ],
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "typeSettings": {
              "additionalResourceOptions": [],
              "selectFirstItem": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "device-list-dropdown",
            "version": "KqlParameterItem/1.0",
            "name": "DeviceList",
            "label": "\ud83d\udcbb Select Devices",
            "type": 2,
            "isRequired": false,
            "isGlobal": true,
            "multiSelect": true,
            "quote": "",
            "delimiter": ",",
            "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"urlParams\": [{\"key\": \"action\", \"value\": \"Get Devices\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.devices[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"value\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"label\"}]}}]}",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 10,
            "description": "\u2705 Auto-populated from Defender XDR",
            "criteriaData": [
              {
                "criterionType": "param",
                "value": "{FunctionAppName}"
              },
              {
                "criterionType": "param",
                "value": "{TenantId}"
              }
            ]
          },
          {
            "id": "scan-type-param",
            "version": "KqlParameterItem/1.0",
            "name": "ScanType",
            "label": "Scan Type",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"Quick\", \"label\": \"Quick Scan\"}, {\"value\": \"Full\", \"label\": \"Full Scan\"}]",
            "value": "Quick"
          },
          {
            "id": "isolation-type-param",
            "version": "KqlParameterItem/1.0",
            "name": "IsolationType",
            "label": "Isolation Type",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"Full\", \"label\": \"Full Isolation\"}, {\"value\": \"Selective\", \"label\": \"Selective Isolation\"}]",
            "value": "Full"
          },
          {
            "id": "cancel-action-id",
            "version": "KqlParameterItem/1.0",
            "name": "CancelActionId",
            "label": "\u274c Action ID to Cancel",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Copy an Action ID from the table below to cancel it"
          },
          {
            "id": "auto-refresh",
            "version": "KqlParameterItem/1.0",
            "name": "AutoRefresh",
            "label": "\ud83d\udd04 Auto Refresh",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"0\", \"label\": \"Off\"}, {\"value\": \"10000\", \"label\": \"Every 10 seconds\"}, {\"value\": \"30000\", \"label\": \"Every 30 seconds\"}, {\"value\": \"60000\", \"label\": \"Every 1 minute\"}, {\"value\": \"300000\", \"label\": \"Every 5 minutes\"}]",
            "value": "30000"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\u26a0\ufe0f Pending Actions Check",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udd0d Checking for Running Actions\n\n\u26a0\ufe0f **Important:** Attempting the same action on a device with a pending action will result in **400 Bad Request**.\n\n**Auto-Refresh:** Every {AutoRefresh:label}"
            },
            "name": "pending-check-info"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[?(@.status=='Pending' || @.status=='InProgress')]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"Device ID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device Name\"}, {\"path\": \"$.type\", \"columnid\": \"Action Type\"}, {\"path\": \"$.id\", \"columnid\": \"Action ID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.creationDateTimeUtc\", \"columnid\": \"Started\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f Currently Running Actions",
              "noDataMessage": "\u2705 No pending actions found. Safe to execute new actions.",
              "noDataMessageStyle": 3,
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Action Type",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Action ID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "CancelActionId",
                      "parameterValue": "{0}",
                      "linkIsContextBlade": false
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "2",
                          "text": "\u2699\ufe0f {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Started",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Started",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "pending-actions-check"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "pending-actions-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udd2c Run Antivirus Scan",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udd2c Run Antivirus Scan\n\nExecute {ScanType} antivirus scan via ARM Actions\n\n**Selected Devices:** {DeviceList:label}"
            },
            "name": "scan-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "scan-link",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd2c Execute Run Antivirus Scan",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invoke",
                    "headers": [],
                    "params": [
                      {
                        "key": "action",
                        "value": "Run Antivirus Scan"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "scanType",
                        "value": "{ScanType}"
                      },
                      {
                        "key": "comment",
                        "value": "ARM Action scan from DefenderC2 Workbook"
                      }
                    ],
                    "isLongOperation": true,
                    "httpMethod": "POST",
                    "title": "Run Antivirus Scan",
                    "description": "Execute Run Antivirus Scan on {DeviceList:label}",
                    "actionName": "Run Antivirus Scan"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "scan-arm-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "scan-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udd12 Isolate Device",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udd12 Isolate Device\n\nIsolate devices ({IsolationType}) via ARM Actions\n\n**Selected Devices:** {DeviceList:label}"
            },
            "name": "isolate-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "isolate-link",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd12 Execute Isolate Device",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invoke",
                    "headers": [],
                    "params": [
                      {
                        "key": "action",
                        "value": "Isolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "isolationType",
                        "value": "{IsolationType}"
                      },
                      {
                        "key": "comment",
                        "value": "ARM Action isolation from DefenderC2 Workbook"
                      }
                    ],
                    "isLongOperation": true,
                    "httpMethod": "POST",
                    "title": "Isolate Device",
                    "description": "Execute Isolate Device on {DeviceList:label}",
                    "actionName": "Isolate Device"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "isolate-arm-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "isolate-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udd13 Unisolate Device",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udd13 Unisolate Device\n\nReconnect devices to network via ARM Actions\n\n**Selected Devices:** {DeviceList:label}"
            },
            "name": "unisolate-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "unisolate-link",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udd13 Execute Unisolate Device",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invoke",
                    "headers": [],
                    "params": [
                      {
                        "key": "action",
                        "value": "Unisolate Device"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "ARM Action unisolation from DefenderC2 Workbook"
                      }
                    ],
                    "isLongOperation": true,
                    "httpMethod": "POST",
                    "title": "Unisolate Device",
                    "description": "Execute Unisolate Device on {DeviceList:label}",
                    "actionName": "Unisolate Device"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "unisolate-arm-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "unisolate-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udce6 Collect Investigation Package",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udce6 Collect Investigation Package\n\nCollect forensic package via ARM Actions\n\n**Selected Devices:** {DeviceList:label}"
            },
            "name": "collect-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "collect-link",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udce6 Execute Collect Investigation Package",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invoke",
                    "headers": [],
                    "params": [
                      {
                        "key": "action",
                        "value": "Collect Investigation Package"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "ARM Action collection from DefenderC2 Workbook"
                      }
                    ],
                    "isLongOperation": true,
                    "httpMethod": "POST",
                    "title": "Collect Investigation Package",
                    "description": "Execute Collect Investigation Package on {DeviceList:label}",
                    "actionName": "Collect Investigation Package"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "collect-arm-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "collect-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udeab Restrict App Execution",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udeab Restrict App Execution\n\nBlock unauthorized apps via ARM Actions\n\n**Selected Devices:** {DeviceList:label}"
            },
            "name": "restrict-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "restrict-link",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\ud83d\udeab Execute Restrict App Execution",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invoke",
                    "headers": [],
                    "params": [
                      {
                        "key": "action",
                        "value": "Restrict App Execution"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "ARM Action restriction from DefenderC2 Workbook"
                      }
                    ],
                    "isLongOperation": true,
                    "httpMethod": "POST",
                    "title": "Restrict App Execution",
                    "description": "Execute Restrict App Execution on {DeviceList:label}",
                    "actionName": "Restrict App Execution"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "restrict-arm-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "restrict-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\u2705 Unrestrict App Execution",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \u2705 Unrestrict App Execution\n\nAllow normal app execution via ARM Actions\n\n**Selected Devices:** {DeviceList:label}"
            },
            "name": "unrestrict-header"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "unrestrict-link",
                  "linkTarget": "ArmAction",
                  "linkLabel": "\u2705 Execute Unrestrict App Execution",
                  "style": "primary",
                  "linkIsContextBlade": false,
                  "armActionContext": {
                    "path": "{FunctionApp}/functions/DefenderC2Dispatcher/invoke",
                    "headers": [],
                    "params": [
                      {
                        "key": "action",
                        "value": "Unrestrict App Execution"
                      },
                      {
                        "key": "tenantId",
                        "value": "{TenantId}"
                      },
                      {
                        "key": "deviceIds",
                        "value": "{DeviceList}"
                      },
                      {
                        "key": "comment",
                        "value": "ARM Action unrestriction from DefenderC2 Workbook"
                      }
                    ],
                    "isLongOperation": true,
                    "httpMethod": "POST",
                    "title": "Unrestrict App Execution",
                    "description": "Execute Unrestrict App Execution on {DeviceList:label}",
                    "actionName": "Unrestrict App Execution"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceList",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "unrestrict-arm-action"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "unrestrict-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\ud83d\udcca Action Status Tracking (Auto-Refresh)",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \ud83d\udcca All Machine Actions\n\n**Auto-Refresh:** Every {AutoRefresh:label}\n\nTrack all actions across your Defender XDR environment."
            },
            "name": "status-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"Device ID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device Name\"}, {\"path\": \"$.type\", \"columnid\": \"Action Type\"}, {\"path\": \"$.id\", \"columnid\": \"Action ID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.creationDateTimeUtc\", \"columnid\": \"Started\"}, {\"path\": \"$.lastUpdateDateTimeUtc\", \"columnid\": \"Last Update\"}, {\"path\": \"$.requestor\", \"columnid\": \"Requestor\"}]}}]}",
              "size": 0,
              "title": "\u2699\ufe0f All Actions",
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "AutoRefresh",
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Action Type",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Action ID",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "parameter",
                      "linkLabel": "\u274c Cancel",
                      "parameterName": "CancelActionId",
                      "parameterValue": "{0}",
                      "linkIsContextBlade": false
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "\u23f3 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "InProgress",
                          "representation": "2",
                          "text": "\u2699\ufe0f {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Succeeded",
                          "representation": "success",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Failed",
                          "representation": "failed",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Started",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Started",
                  "sortOrder": 2
                }
              ]
            },
            "name": "all-actions-query"
          }
        ]
      },
      "name": "status-tracking-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "\u274c Cancel Action",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### \u274c Cancel Machine Action\n\n**Action ID:** {CancelActionId}\n\nClick an Action ID above to auto-populate, then execute cancellation."
            },
            "name": "cancel-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"urlParams\": [{\"key\": \"action\", \"value\": \"Cancel Action\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}, {\"key\": \"actionId\", \"value\": \"{CancelActionId}\"}, {\"key\": \"comment\", \"value\": \"Cancelled via DefenderC2 Workbook\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"columns\": [{\"path\": \"$.message\", \"columnid\": \"Result\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.details\", \"columnid\": \"Details\"}]}}]}",
              "size": 0,
              "title": "\u2705 Cancellation Result",
              "timeContext": {
                "durationMs": 86400000
              },
              "showRefreshButton": true,
              "queryType": 10,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "success",
                          "representation": "green",
                          "text": "\u2705 {0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "error",
                          "representation": "redBright",
                          "text": "\u274c {0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "CancelActionId",
              "comparison": "isNotEqualTo",
              "value": ""
            },
            "name": "cancel-query"
          }
        ]
      },
      "name": "cancel-group"
    }
  ],
  "styleSettings": {},
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}