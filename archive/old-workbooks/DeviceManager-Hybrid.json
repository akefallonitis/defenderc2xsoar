{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# \ud83d\udda5\ufe0f DefenderC2 Device Manager - Hybrid\\n\\n## \u26a1 ARM Actions with Smart Filtering\\n\\n### \u2728 Features:\\n- \u2705 **Native ARM Actions** - Azure RBAC enforcement\\n- \ud83c\udfaf **Smart Filtering** - Shows only actions for selected devices\\n- \ud83d\udcbb **Device Management** - Click to select, auto-filter results\\n- \ud83d\udcca **Live Monitoring** - Auto-refresh status\\n- \u26a0\ufe0f **Conflict Detection** - Prevents duplicate actions\\n- \u274c **One-Click Cancel** - Cancel any action\\n\\n### \ud83d\ude80 Workflow:\\n1. Select devices \u2192 Device list populates\\n2. Conflict check auto-filters by selected devices\\n3. Execute ARM Actions \u2192 Azure confirmation\\n4. Status tracking auto-filters by selected devices\\n5. Cancel actions with one click"
      },
      "name": "header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "fa",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionApp",
            "label": "DefenderC2 Function App",
            "type": 5,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where type == 'microsoft.web/sites' and kind == 'functionapp' | project id, name, resourceGroup, subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false,
              "resourceTypeFilter": {
                "microsoft.web/sites": true
              }
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "sub",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = subscriptionId",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "rg",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = resourceGroup",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "fn",
            "version": "KqlParameterItem/1.0",
            "name": "FunctionAppName",
            "type": 1,
            "isRequired": true,
            "isGlobal": true,
            "query": "Resources | where id == '{FunctionApp}' | project value = name",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "tid",
            "version": "KqlParameterItem/1.0",
            "name": "TenantId",
            "label": "Defender XDR Tenant",
            "type": 2,
            "isRequired": true,
            "isGlobal": true,
            "query": "ResourceContainers | where type == 'microsoft.resources/subscriptions' | project tenantId | distinct tenantId | project value = tenantId, label = strcat('Tenant: ', tenantId)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "selectFirstItem": true,
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "dev",
            "version": "KqlParameterItem/1.0",
            "name": "DeviceList",
            "label": "\ud83d\udda5\ufe0f Selected Devices",
            "type": 1,
            "isGlobal": true,
            "value": "",
            "description": "Click devices below to select (auto-filters results)"
          },
          {
            "id": "fh",
            "version": "KqlParameterItem/1.0",
            "name": "FileHash",
            "label": "\ud83e\udda0 File Hash (SHA1)",
            "type": 1,
            "isGlobal": true,
            "value": ""
          },
          {
            "id": "aid",
            "version": "KqlParameterItem/1.0",
            "name": "ActionIdToCancel",
            "label": "\ud83d\uddd1\ufe0f Action ID",
            "type": 1,
            "isGlobal": true,
            "value": ""
          },
          {
            "id": "ref",
            "version": "KqlParameterItem/1.0",
            "name": "AutoRefresh",
            "label": "\ud83d\udd04 Auto Refresh",
            "type": 2,
            "isGlobal": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"0\", \"label\": \"Off\"}, {\"value\": \"30000\", \"label\": \"Every 30 seconds\"}, {\"value\": \"60000\", \"label\": \"Every 1 minute\"}]",
            "value": "30000"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "---\\n\\n## \ud83d\udcbb STEP 1: Device Inventory\\n\\n**Click '\u2705 Select' to add devices** | **Selected:** {DeviceList}"
      },
      "name": "inv-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get Devices\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.devices[*]\", \"columns\": [{\"path\": \"$.id\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"ComputerName\"}, {\"path\": \"$.osPlatform\", \"columnid\": \"OS\"}, {\"path\": \"$.healthStatus\", \"columnid\": \"Health\"}, {\"path\": \"$.riskScore\", \"columnid\": \"Risk\"}, {\"path\": \"$.exposureLevel\", \"columnid\": \"Exposure\"}]}}]}",
        "size": 0,
        "title": "\ud83d\udda5\ufe0f All Devices",
        "showRefreshButton": true,
        "queryType": 10,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "DeviceID",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "parameter",
                "linkLabel": "\u2705 Select",
                "parameterName": "DeviceList",
                "parameterValue": "{DeviceList},{0}"
              }
            },
            {
              "columnMatch": "Health",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Active",
                    "representation": "success",
                    "text": "\u2705 {0}"
                  },
                  {
                    "operator": "Default",
                    "representation": "unknown",
                    "text": "{0}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Risk",
              "formatter": 8,
              "formatOptions": {
                "palette": "redGreen"
              }
            },
            {
              "columnMatch": "Exposure",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "redBright",
                    "text": "\ud83d\udd34 {0}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "\ud83d\udfe0 {0}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Low",
                    "representation": "green",
                    "text": "\ud83d\udfe2 {0}"
                  },
                  {
                    "operator": "Default",
                    "representation": "blue",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true,
          "sortBy": [
            {
              "itemKey": "ComputerName",
              "sortOrder": 1
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "ComputerName",
            "sortOrder": 1
          }
        ]
      },
      "name": "inventory"
    },
    {
      "type": 1,
      "content": {
        "json": "---\\n\\n## \u26a0\ufe0f STEP 2: Conflict Detection\\n\\n**\ud83c\udfaf Smart Filter:** Showing only actions for selected devices\\n\\n**Selected Devices:** {DeviceList}"
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "conflict-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.type\", \"columnid\": \"RunningAction\"}, {\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}]}}]}",
        "size": 0,
        "title": "\u2699\ufe0f Running Actions on Selected Devices",
        "noDataMessage": "\u2705 NO CONFLICTS - Safe to execute",
        "noDataMessageStyle": 3,
        "showRefreshButton": true,
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "AutoRefresh",
        "queryType": 10,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "RunningAction",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "representation": "orange",
                    "text": "\u26a0\ufe0f {0} - Check before executing same action"
                  }
                ]
              }
            },
            {
              "columnMatch": "ActionID",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "parameter",
                "linkLabel": "\u274c Cancel",
                "parameterName": "ActionIdToCancel",
                "parameterValue": "{0}"
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Pending",
                    "representation": "pending",
                    "text": "\u23f3 {0}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "InProgress",
                    "representation": "2",
                    "text": "\u2699\ufe0f {0}"
                  },
                  {
                    "operator": "Default",
                    "representation": "unknown",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true,
          "filterSettings": {
            "defaultFilters": [
              {
                "columnId": "DeviceID",
                "operator": "in",
                "value": "{DeviceList}"
              }
            ]
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "conflict-check"
    },
    {
      "type": 1,
      "content": {
        "json": "---\\n\\n## \u26a1 STEP 3: Execute ARM Actions\\n\\n**Selected Devices:** {DeviceList}\\n\\n**Azure will show confirmation dialog before execution.**"
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "arm-header"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "list",
        "links": [
          {
            "id": "arm-scan",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udd0d Run Antivirus Scan",
            "style": "primary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Run Antivirus Scan"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Run Antivirus Scan via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Run Antivirus Scan",
              "description": "Run Antivirus Scan initiated successfully",
              "actionName": "Run Antivirus Scan",
              "runLabel": "Execute Run Antivirus Scan",
              "successMessage": "\u2705 Run Antivirus Scan command sent successfully!"
            }
          },
          {
            "id": "arm-isolate",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udd12 Isolate Device (DESTRUCTIVE)",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Isolate Device"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Isolate Device via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Isolate Device",
              "description": "Isolate Device initiated successfully",
              "actionName": "Isolate Device",
              "runLabel": "Execute Isolate Device",
              "successMessage": "\u2705 Isolate Device command sent successfully!"
            }
          },
          {
            "id": "arm-unisolate",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udd13 Unisolate Device",
            "style": "primary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Unisolate Device"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Unisolate Device via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Unisolate Device",
              "description": "Unisolate Device initiated successfully",
              "actionName": "Unisolate Device",
              "runLabel": "Execute Unisolate Device",
              "successMessage": "\u2705 Unisolate Device command sent successfully!"
            }
          },
          {
            "id": "arm-collect",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udce6 Collect Investigation Package",
            "style": "primary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Collect Investigation Package"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Collect Investigation Package via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Collect Investigation Package",
              "description": "Collect Investigation Package initiated successfully",
              "actionName": "Collect Investigation Package",
              "runLabel": "Execute Collect Investigation Package",
              "successMessage": "\u2705 Collect Investigation Package command sent successfully!"
            }
          },
          {
            "id": "arm-restrict",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83d\udeab Restrict App Execution (DESTRUCTIVE)",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Restrict App Execution"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Restrict App Execution via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Restrict App Execution",
              "description": "Restrict App Execution initiated successfully",
              "actionName": "Restrict App Execution",
              "runLabel": "Execute Restrict App Execution",
              "successMessage": "\u2705 Restrict App Execution command sent successfully!"
            }
          },
          {
            "id": "arm-unrestrict",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\u2705 Unrestrict App Execution",
            "style": "primary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Unrestrict App Execution"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "deviceIds",
                  "value": "{DeviceList}"
                },
                {
                  "key": "comment",
                  "value": "Unrestrict App Execution via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Unrestrict App Execution",
              "description": "Unrestrict App Execution initiated successfully",
              "actionName": "Unrestrict App Execution",
              "runLabel": "Execute Unrestrict App Execution",
              "successMessage": "\u2705 Unrestrict App Execution command sent successfully!"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "DeviceList",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "arm-device-actions"
    },
    {
      "type": 1,
      "content": {
        "json": "---\\n\\n## \ud83e\udda0 File Quarantine\\n\\n**File Hash:** {FileHash}"
      },
      "conditionalVisibility": {
        "parameterName": "FileHash",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "file-header"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "list",
        "links": [
          {
            "id": "arm-quarantine",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\ud83e\udda0 Stop & Quarantine File (DESTRUCTIVE)",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Stop & Quarantine File"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "fileHash",
                  "value": "{FileHash}"
                },
                {
                  "key": "comment",
                  "value": "Quarantined via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Stop & Quarantine File",
              "description": "File quarantine initiated successfully",
              "actionName": "Stop & Quarantine File",
              "runLabel": "Execute Quarantine",
              "successMessage": "\u2705 File quarantine command sent successfully!"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "FileHash",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "arm-file-action"
    },
    {
      "type": 1,
      "content": {
        "json": "---\\n\\n## \ud83d\udcca STEP 4: Status Tracking\\n\\n**\ud83c\udfaf Smart Filter:** {DeviceList:nonempty:Showing all actions|Showing only actions for selected devices}"
      },
      "name": "status-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\": \"CustomEndpoint/1.0\", \"data\": null, \"headers\": [], \"method\": \"POST\", \"url\": \"https://{FunctionAppName}.azurewebsites.net/api/DefenderC2Dispatcher\", \"body\": null, \"urlParams\": [{\"key\": \"action\", \"value\": \"Get All Actions\"}, {\"key\": \"tenantId\", \"value\": \"{TenantId}\"}], \"transformers\": [{\"type\": \"jsonpath\", \"settings\": {\"tablePath\": \"$.actions[*]\", \"columns\": [{\"path\": \"$.machineId\", \"columnid\": \"DeviceID\"}, {\"path\": \"$.computerDnsName\", \"columnid\": \"Device\"}, {\"path\": \"$.type\", \"columnid\": \"Action\"}, {\"path\": \"$.id\", \"columnid\": \"ActionID\"}, {\"path\": \"$.status\", \"columnid\": \"Status\"}, {\"path\": \"$.creationDateTimeUtc\", \"columnid\": \"Started\"}]}}]}",
        "size": 0,
        "title": "\u2699\ufe0f Machine Actions",
        "showRefreshButton": true,
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "AutoRefresh",
        "queryType": 10,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "ActionID",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "parameter",
                "linkLabel": "\u274c Cancel",
                "parameterName": "ActionIdToCancel",
                "parameterValue": "{0}"
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Pending",
                    "representation": "pending",
                    "text": "\u23f3 {0}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "InProgress",
                    "representation": "2",
                    "text": "\u2699\ufe0f {0}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Succeeded",
                    "representation": "success",
                    "text": "\u2705 {0}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Failed",
                    "representation": "failed",
                    "text": "\u274c {0}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Cancelled",
                    "representation": "cancelled",
                    "text": "\ud83d\udeab {0}"
                  },
                  {
                    "operator": "Default",
                    "representation": "unknown",
                    "text": "{0}"
                  }
                ]
              }
            }
          ],
          "filter": true,
          "filterSettings": {
            "defaultFilters": [
              {
                "columnId": "DeviceID",
                "operator": "in",
                "value": "{DeviceList}"
              }
            ]
          },
          "sortBy": [
            {
              "itemKey": "Started",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "Started",
            "sortOrder": 2
          }
        ]
      },
      "name": "all-actions"
    },
    {
      "type": 1,
      "content": {
        "json": "---\\n\\n## \u274c STEP 5: Cancel Action\\n\\n**Action ID:** {ActionIdToCancel}"
      },
      "conditionalVisibility": {
        "parameterName": "ActionIdToCancel",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "cancel-header"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "list",
        "links": [
          {
            "id": "arm-cancel",
            "cellValue": "unused",
            "linkTarget": "ArmAction",
            "linkLabel": "\u274c Cancel Action",
            "style": "secondary",
            "armActionContext": {
              "path": "/subscriptions/{Subscription}/resourceGroups/{ResourceGroup}/providers/Microsoft.Web/sites/{FunctionAppName}/functions/DefenderC2Dispatcher/invocations",
              "headers": [],
              "params": [
                {
                  "key": "api-version",
                  "value": "2022-03-01"
                },
                {
                  "key": "action",
                  "value": "Cancel Action"
                },
                {
                  "key": "tenantId",
                  "value": "{TenantId}"
                },
                {
                  "key": "actionId",
                  "value": "{ActionIdToCancel}"
                },
                {
                  "key": "comment",
                  "value": "Cancelled via DefenderC2 Workbook"
                }
              ],
              "httpMethod": "POST",
              "title": "\u2705 Cancel Action",
              "description": "Action cancelled successfully",
              "actionName": "Cancel Action",
              "runLabel": "Cancel",
              "successMessage": "\u2705 Action cancellation command sent successfully!"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ActionIdToCancel",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "cancel-action"
    }
  ],
  "styleSettings": {},
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}