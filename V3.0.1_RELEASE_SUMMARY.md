# DefenderC2 v3.0.1 Release Summary

**Release Date**: November 13, 2025  
**Focus**: Action-Oriented XDR (Remove Monitoring Bloat)

---

## üéØ What Changed

### 1. **Permission Reduction** (15 ‚Üí 13)

**REMOVED:**
- ‚ùå `Policy.Read.All` - Not needed for remediation (only for read-only CA policy viewing)
- ‚ùå `AuditLog.Read.All` - Not needed for remediation (only for audit/sign-in log viewing)

**KEPT (13 permissions):**
- ‚úÖ Microsoft Graph API: 10 permissions (User, Device, IdentityRisk, Mail, DeviceManagement)
- ‚úÖ Microsoft Defender for Endpoint API: 3 permissions (Machine operations)

**Impact:**
- **Benefit**: Clearer permission justification - all action-focused
- **Security**: Reduced permission surface area (no compliance/monitoring read access)

---

### 2. **Action Count Reduction** (213 ‚Üí 187)

**REMOVED 26 MONITORING/READ-ONLY ACTIONS:**

| Worker | Before | After | Removed Actions |
|--------|--------|-------|-----------------|
| **MDI** | 11 | 1 | -10 (GetAlerts, GetIdentitySecureScore, GetSuspiciousActivities, GetHealthIssues, GetRecommendations, GetSensitiveUsers, GetAlertStatistics, GetConfiguration, GetLateralMovementPaths, GetExposedCredentials) |
| **Entra ID** | 20 | 14 | -6 (GetRiskDetections, GetRiskyUsers, GetConditionalAccessPolicies, GetSignInLogs, GetAuditLogs, GetUser) |
| **Intune** | 18 | 15 | -3 (GetManagedDevices, GetDeviceCompliance, GetDeviceConfiguration) |
| **Azure** | 23 | 18 | -7 (GetVMs, GetResourceGroups, GetNSGs, GetStorageAccounts, GetSecurityRecommendations, GetSecureScore, GetDefenderPlans, GetRegulatoryCompliance, GetJitAccessPolicies) + 2 new firewall actions |
| **MDE** | 63 | 61 | -2 (GetAllActions, GetQueryHistory) |
| **MDO** | 16 | 16 | ‚úÖ No changes |
| **MCAS** | 15 | 15 | ‚úÖ No changes |

**PLANNED ADDITIONS** (not yet implemented):
- ‚ú® `AddAzureFirewallDenyRule` (Azure Worker)
- ‚ú® `RemoveAzureFirewallDenyRule` (Azure Worker)

**Impact:**
- **Benefit**: Clear focus on remediation, not compliance dashboards
- **Alternative**: Use native portals for monitoring (Azure Security Center, Azure AD portal, Intune portal)

---

### 3. **MDEAutomator References Removed**

**FILES CLEANED:**
- ‚úÖ `docs/WORKBOOK_MDEAUTOMATOR_PORT.md` - **DELETED** (624 lines of legacy documentation)
- ‚úÖ `examples/sample-config.md` - Updated function app URLs
- ‚úÖ All non-archive files - Replaced "MDEAutomator"/"mde-automator" with "DefenderC2"/"defenderc2"

**Impact:**
- **Benefit**: Clean branding, no confusion with upstream project
- **Note**: Archive folder retained for historical reference

---

### 4. **Documentation Overhaul**

**NEW FILES:**
- ‚úÖ `ACTION_CLEANUP_PLAN.md` - Detailed justification for removed actions
- ‚úÖ `README.md` - Complete rewrite with action-focused messaging

**UPDATED FILES:**
- ‚úÖ `deployment/Configure-AppPermissions.ps1` - Updated to 13 permissions with v3.0.1 notes
- ‚úÖ All scripts - MDEAutomator references removed

**NEW README HIGHLIGHTS:**
- Quick Start (3 steps: permissions ‚Üí deploy ‚Üí test)
- Worker capability table with action counts
- Clear use cases and examples
- FAQ explaining v3.0.1 changes
- Architecture highlights
- Roadmap for v3.1.0 and v3.2.0

---

## üöÄ Quick Migration Guide

### For Existing v3.0.0 Deployments

#### Step 1: Update App Registration Permissions

```powershell
# Run updated permission script
cd deployment
.\Configure-AppPermissions.ps1 -AppId "your-app-id" -TenantId "your-tenant-id"

# Grant admin consent at provided URL
```

**What happens:**
- Removes ALL existing permissions
- Adds 13 new permissions (removes Policy.Read.All, AuditLog.Read.All)
- No API disruption (token refresh on next request)

#### Step 2: Update Code (If Using Removed Actions)

**REMOVED ACTIONS YOU MAY NEED TO REPLACE:**

| Removed Action | Alternative |
|----------------|-------------|
| `GetSecureScore` (Azure) | Use Azure Security Center portal |
| `GetAuditLogs` (Entra ID) | Use Azure AD portal or Log Analytics |
| `GetSignInLogs` (Entra ID) | Use Azure AD portal or Log Analytics |
| `GetIdentitySecureScore` (MDI) | Use Defender for Identity portal |
| `GetDeviceComplianceStatus` (Intune) | Use Intune portal |
| `GetSecurityRecommendations` (Azure) | Use Microsoft Defender for Cloud portal |
| All MDI "Get*" actions except `UpdateAlert` | Use Defender for Identity portal for investigation |

#### Step 3: Deploy Updated Code

```powershell
# Pull latest code
git pull origin main

# Redeploy Function App
cd deployment
.\Deploy-DefenderC2.ps1 -ResourceGroupName "your-rg" -FunctionAppName "your-app"
```

---

## üìä Impact Summary

### Reduced Surface Area

| Metric | Before (v3.0.0) | After (v3.0.1) | Change |
|--------|-----------------|----------------|--------|
| **App Permissions** | 15 | 13 | **-2** |
| **Total Actions** | 213 | 187 | **-26** |
| **Read-Only Actions** | 35 | 9 | **-26** |
| **Remediation Actions** | 178 | 178 | ‚úÖ |

### Worker Changes

| Worker | Action Type Changes | Impact |
|--------|---------------------|--------|
| **MDI** | Investigation ‚Üí Alert Management only | **Breaking**: All "Get*" actions removed except `UpdateAlert` |
| **Entra ID** | Identity Protection ‚Üí No audit log read | **Minor**: Removed 6 read-only actions, kept all remediation |
| **Intune** | Device Management ‚Üí No compliance read | **Minor**: Removed 3 read-only actions, kept all remediation |
| **Azure** | Infrastructure Security ‚Üí No compliance/monitoring | **Minor**: Removed 7 read actions, added 2 firewall actions (planned) |
| **MDE** | Full capabilities ‚Üí No admin queries | **Minor**: Removed 2 query/admin actions |
| **MDO** | Email Security ‚Üí No changes | ‚úÖ **No impact** |
| **MCAS** | Cloud App Security ‚Üí No changes | ‚úÖ **No impact** |

---

## üéØ Design Philosophy

### v3.0.1 Focus

**ACTION-ORIENTED XDR**
- ‚úÖ Incident response actions
- ‚úÖ Threat containment
- ‚úÖ User/device remediation
- ‚ùå Compliance dashboards
- ‚ùå Security score monitoring
- ‚ùå Audit log viewing

**Use Case:**
- **DefenderC2**: Automated incident response via SOAR/playbooks
- **Native Portals**: Manual investigation, compliance monitoring, dashboards

---

## üîÑ Breaking Changes

### API Changes

**REMOVED ACTIONS** (will return `400 Bad Request` if called):
- MDI: `GetAlerts`, `GetLateralMovementPaths`, `GetExposedCredentials`, `GetIdentitySecureScore`, `GetSuspiciousActivities`, `GetHealthIssues`, `GetRecommendations`, `GetSensitiveUsers`, `GetAlertStatistics`, `GetConfiguration`
- Entra ID: `GetRiskDetections`, `GetRiskyUsers`, `GetConditionalAccessPolicies`, `GetSignInLogs`, `GetAuditLogs`, `GetUser`
- Intune: `GetManagedDevices`, `GetDeviceCompliance`, `GetDeviceConfiguration`
- Azure: `GetVMs`, `GetResourceGroups`, `GetNSGs`, `GetStorageAccounts`, `GetSecurityRecommendations`, `GetSecureScore`, `GetDefenderPlans`, `GetRegulatoryCompliance`, `GetJitAccessPolicies`
- MDE: `GetAllActions`, `GetQueryHistory`

### Permission Changes

**REMOVED PERMISSIONS:**
- `Policy.Read.All` - No longer needed (removed `GetConditionalAccessPolicies`)
- `AuditLog.Read.All` - No longer needed (removed `GetSignInLogs`, `GetAuditLogs`)

**ACTION REQUIRED:**
- Re-run `Configure-AppPermissions.ps1`
- Grant admin consent
- Update any playbooks/workflows using removed actions

---

## ‚úÖ Testing Checklist

After updating to v3.0.1:

- [ ] Run `Configure-AppPermissions.ps1` to update permissions
- [ ] Grant admin consent at provided URL
- [ ] Redeploy Function App with latest code
- [ ] Test one action per worker:
  - [ ] MDE: `IsolateDevice`
  - [ ] MDO: `SoftDeleteEmails`
  - [ ] Entra ID: `DisableUser`
  - [ ] Intune: `RemoteLockDevice`
  - [ ] MDI: `UpdateAlert`
  - [ ] MCAS: `RevokeOAuthApp`
  - [ ] Azure: `AddNSGDenyRule`
- [ ] Verify no errors in Application Insights
- [ ] Update any playbooks using removed actions

---

## üìö Documentation Updates

### New Documentation

- [**ACTION_CLEANUP_PLAN.md**](ACTION_CLEANUP_PLAN.md) - Detailed removal justification
- [**README.md**](README.md) - Complete rewrite with v3.0.1 focus

### Updated Documentation

- [**Configure-AppPermissions.ps1**](deployment/Configure-AppPermissions.ps1) - 13 permissions
- [**PERMISSIONS.md**](PERMISSIONS.md) - (needs update)
- [**WORKER_API_REFERENCE.md**](WORKER_API_REFERENCE.md) - (needs update)

### Archived Documentation

- [**README.OLD.md**](README.OLD.md) - Previous version (for reference)

---

## üõ†Ô∏è Remaining Work (Not Yet Implemented)

### Code Changes Needed

1. **Remove actions from worker run.ps1 files** ‚è≥
   - DefenderXDRMDIWorker - Remove 10 actions
   - DefenderXDREntraIDWorker - Remove 6 actions
   - DefenderXDRIntuneWorker - Remove 3 actions
   - DefenderXDRAzureWorker - Remove 7 actions, add 2 firewall actions
   - DefenderXDRMDEWorker - Remove 2 actions

2. **Update ARM template descriptions** ‚è≥
   - Update action counts in descriptions
   - Update parameter descriptions

3. **Create deployment package** ‚è≥
   - Zip deployment files
   - Include one-click deployment guide

4. **Update PERMISSIONS.md** ‚è≥
   - Reflect 13 permissions (down from 15)
   - Update action counts per worker

5. **Update WORKER_API_REFERENCE.md** ‚è≥
   - Remove documentation for deleted actions
   - Add Azure Firewall actions

---

## üéâ Summary

**v3.0.1 is a CLEANUP RELEASE focused on:**
- ‚úÖ Least privilege permissions (13 down from 15)
- ‚úÖ Action-focused design (187 actions, -26 monitoring)
- ‚úÖ Clean branding (no MDEAutomator references)
- ‚úÖ Better documentation (new README, cleanup plan)

**Next Steps:**
1. ‚úÖ Permission script updated
2. ‚úÖ Documentation updated
3. ‚úÖ Changes committed and pushed
4. ‚è≥ Remove monitoring actions from worker code
5. ‚è≥ Add Azure Firewall actions
6. ‚è≥ Create one-click deployment package

**Status**: **Permission and documentation changes complete**. Code changes in progress.

